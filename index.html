    <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>АРТФЛОРА</title>
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#6b7280;--primary-dark:#374151;--primary-light:#d1d5db;
            --secondary:#9ca3af;--secondary-dark:#6b7280;--accent:#6b7280;
            --accent-dark:#374151;--text:#1f2937;--text-light:#6b7280;
            --text-lighter:#9ca3af;--bg:#ffffff;--bg-secondary:#f8fafc;
            --bg-tertiary:#f1f5f9;--card-bg:#ffffff;--shadow:0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg:0 10px 25px rgba(0,0,0,0.12);--shadow-sm:0 1px 4px rgba(0,0,0,0.06);
            --border:1px solid #e5e7eb;--radius:16px;--radius-sm:10px;--radius-lg:20px;
            --header-bg:linear-gradient(135deg,#6b7280 0%,#374151 100%);
            --price-color:#000000;--button-bg:linear-gradient(135deg,#6b7280 0%,#374151 100%);
            --fact-border:#6b7280;--fact-icon:#f59e0b;
        }
        body{
            font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
            background:var(--header-bg);
            color:var(--text);min-height:100vh;line-height:1.5;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            overflow-x:hidden
        }
        @supports(padding:max(0px)){
            body{padding-left:max(0px,env(safe-area-inset-left));padding-right:max(0px,env(safe-area-inset-right));padding-top:max(0px,env(safe-area-inset-top));padding-bottom:max(0px,env(safe-area-inset-bottom))}
        }
        .app-container{max-width:100%;margin:0 auto;background:var(--bg);min-height:100vh;position:relative;overflow-x:hidden}
        @media(min-width:401px){.app-container{max-width:400px}}
        
        .snow-container,.rain-container,.confetti-container,.night-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;display:none}
        .snowflake{position:absolute;background:white;border-radius:50%;opacity:0.8;animation:fall linear infinite}
        .raindrop{position:absolute;background:linear-gradient(to bottom, rgba(59,130,246,0.9), rgba(147,197,253,0.6));width:3px;height:20px;animation:rainFall linear infinite;box-shadow:0 0 4px rgba(59,130,246,0.5);border-radius:0 0 2px 2px}
        .confetti{position:absolute;width:12px;height:12px;opacity:0.85;animation:confettiFall linear infinite;box-shadow:0 2px 4px rgba(0,0,0,0.2);filter:drop-shadow(0 0 2px rgba(255,255,255,0.5))}
        .night-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.88);z-index:1;backdrop-filter:blur(3px)}
        .light-spot{position:absolute;width:160px;height:160px;border-radius:50%;background:radial-gradient(circle, rgba(255,255,255,0.50) 0%, rgba(255,255,255,0.24) 35%, rgba(255,255,255,0) 70%);pointer-events:none;z-index:2;mix-blend-mode:screen;transform:translate(-50%,-50%);transition:opacity 0.2s ease}
        .night-mode-active .app-container{color:rgba(255,255,255,0.92)}
        .night-mode-active .app-container *{text-shadow:0 0 8px rgba(255,255,255,0.18)}
        .night-mode-active .app-container button,
        .night-mode-active .app-container .btn,
        .night-mode-active .app-container .category-btn,
        .night-mode-active .app-container .add-to-cart,
        .night-mode-active .app-container .cart-button,
        .night-mode-active .app-container .admin-button,
        .night-mode-active .app-container .help-button,
        .night-mode-active .app-container input,
        .night-mode-active .app-container textarea,
        .night-mode-active .app-container .product-card,
        .night-mode-active .app-container .product-fact,
        .night-mode-active .app-container .stat-card,
        .night-mode-active .app-container .product-form,
        .night-mode-active .app-container .admin-table-container,
        .night-mode-active .app-container .modal-content{border:2px solid rgba(255,255,255,0.35)!important;box-shadow:0 0 12px rgba(255,255,255,0.10),inset 0 0 12px rgba(255,255,255,0.05)!important}
        .night-mode-active .app-container input::placeholder,
        .night-mode-active .app-container textarea::placeholder{color:rgba(255,255,255,0.55)}
        .night-mode-active .app-container .product-title,
        .night-mode-active .app-container .product-price,
        .night-mode-active .app-container .stat-value{text-shadow:0 0 10px rgba(255,255,255,0.35),0 0 18px rgba(255,255,255,0.18)}
        .fact-light{position:relative;overflow:hidden}
        .fact-light:hover::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at var(--mouse-x) var(--mouse-y), rgba(255,255,255,0.2) 0%, transparent 50%);pointer-events:none}
        .fact-light:hover .fact-icon{color:#fbbf24;text-shadow:0 0 10px #f59e0b,0 0 20px #f59e0b;transform:scale(1.1)}
        .fact-icon{transition:all 0.3s ease}
        @keyframes fall{0%{transform:translateY(-10px) rotate(0deg)}100%{transform:translateY(100vh) rotate(360deg)}}
        @keyframes rainFall{0%{transform:translateY(-10px) translateX(0)}100%{transform:translateY(100vh) translateX(10px)}}
        @keyframes confettiFall{0%{transform:translateY(-10px) rotate(0deg)}50%{transform:translateY(50vh) rotate(180deg)}100%{transform:translateY(100vh) rotate(360deg)}}
        @keyframes pulse{0%{opacity:0.2}100%{opacity:0.5}}
        @keyframes spotAppear{0%{opacity:0;transform:translate(-50%,-50%) scale(0)}50%{opacity:0.6;transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-50%) scale(1.5)}}
        
        .header{background:var(--header-bg);color:white;padding:40px 20px 30px;text-align:center;position:relative;overflow:hidden}
        .header.dots::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse"><circle cx="15" cy="15" r="5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>')}
        .header.lines::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="lines" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="0" y2="20" stroke="white" stroke-width="2" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23lines)"/></svg>')}
        .header.flowers::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="flowers" x="0" y="0" width="25" height="25" patternUnits="userSpaceOnUse"><path d="M12.5,5 C10,5 7.5,7.5 7.5,10 C7.5,12.5 10,15 12.5,15 C15,15 17.5,12.5 17.5,10 C17.5,7.5 15,5 12.5,5 Z" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23flowers)"/></svg>')}
        .header.hearts::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="hearts" x="0" y="0" width="25" height="25" patternUnits="userSpaceOnUse"><path d="M12.5,6 C10,6 7.5,8.5 7.5,11 C7.5,13.5 10,16 12.5,16 C15,16 17.5,13.5 17.5,11 C17.5,8.5 15,6 12.5,6 Z" fill="white" opacity="0.1" transform="rotate(45 12.5 11)"/></pattern></defs><rect width="100" height="100" fill="url(%23hearts)"/></svg>')}
        .header.stars::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><polygon points="10,2 12,8 18,8 13,12 15,18 10,14 5,18 7,12 2,8 8,8" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>')}
        .header.waves::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="waves" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse"><path d="M0,15 Q15,5 30,15 T60,15 T90,15 T120,15" stroke="white" stroke-width="2" fill="none" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23waves)"/></svg>')}
        .header.geometric::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="geometric" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="10" height="10" fill="white" opacity="0.1"/><rect x="10" y="10" width="10" height="10" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23geometric)"/></svg>')}
        .header-content{position:relative;z-index:2}
        .header h1{font-size:28px;font-weight:800;margin-bottom:6px;text-shadow:0 2px 4px rgba(0,0,0,0.2)}
        .header p{font-size:14px;opacity:0.95;font-weight:500;margin-bottom:12px}
        .delivery-info{background:rgba(255,255,255,0.2);padding:10px 14px;border-radius:12px;font-size:13px;font-weight:600;backdrop-filter:blur(10px);margin-top:8px}
        
        .categories{display:flex;gap:6px;padding:16px;overflow-x:auto;background:var(--bg);border-bottom:var(--border)}
        .category-btn{padding:12px 18px;border:2px solid #e5e7eb;border-radius:16px;background:white;color:var(--text);font-weight:600;white-space:nowrap;cursor:pointer;transition:all 0.2s ease;font-size:13px;display:flex;align-items:center;gap:4px;flex-shrink:0}
        .category-btn.active{background:var(--button-bg);color:white;border-color:var(--primary);box-shadow:var(--shadow-sm)}
        
        .products-grid{padding:16px;display:grid;gap:16px;padding-bottom:80px}
        .product-card{background:var(--card-bg);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:all 0.3s ease;border:var(--border)}
        .product-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
        .product-image{width:100%;height:180px;background:linear-gradient(135deg,#f3f4f6 0%,#e5e7eb 100%);position:relative;overflow:hidden}
        .product-image img{width:100%;height:100%;object-fit:cover}
        .product-badge{position:absolute;top:10px;right:10px;background:var(--button-bg);color:white;padding:4px 10px;border-radius:10px;font-size:11px;font-weight:700}
        .product-content{padding:16px}
        .product-title{font-size:16px;font-weight:700;margin-bottom:6px;color:var(--text);line-height:1.3}
        .product-description{font-size:13px;color:var(--text-light);margin-bottom:10px;line-height:1.4}
        .product-fact{background:white;padding:10px 12px;border-radius:var(--radius-sm);margin-bottom:12px;border:2px solid var(--fact-border);display:flex;align-items:flex-start;cursor:pointer}
        .product-fact i{color:var(--fact-icon);margin-right:8px;transition:all 0.3s ease;flex-shrink:0;margin-top:2px}
        .product-fact:hover i{color:#fbbf24;text-shadow:0 0 10px var(--fact-icon),0 0 20px var(--fact-icon);transform:scale(1.1)}
        .product-fact-text{font-size:12px;color:var(--text);font-style:italic;line-height:1.4;flex:1}
        .product-fact.lamp-on{position:relative}
        .product-fact.lamp-on .fact-icon{color:#fbbf24;text-shadow:0 0 14px rgba(245,158,11,0.95),0 0 30px rgba(245,158,11,0.55),0 0 60px rgba(245,158,11,0.35);transform:scale(1.08)}
        .night-mode-active .product-fact.lamp-on{border-color:rgba(255,255,255,0.55)!important;box-shadow:0 0 18px rgba(255,255,255,0.18),0 0 24px rgba(245,158,11,0.22),inset 0 0 12px rgba(245,158,11,0.10)!important}
        .night-mode-active .product-fact.lamp-on::after{content:'';position:absolute;left:10px;top:50%;width:220px;height:220px;transform:translateY(-50%);background:radial-gradient(circle, rgba(245,158,11,0.30) 0%, rgba(245,158,11,0.14) 28%, rgba(245,158,11,0.06) 48%, rgba(245,158,11,0) 70%);pointer-events:none;filter:blur(1px)}
        .product-footer{display:flex;justify-content:space-between;align-items:center}
        .product-price{font-size:18px;font-weight:800;color:var(--price-color)}
        .add-to-cart{background:var(--button-bg);color:white;border:none;border-radius:16px;padding:12px 16px;font-weight:600;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;gap:6px;font-size:13px;min-height:44px}
        .add-to-cart:hover{transform:scale(1.05)}
        
        .floating-buttons{position:fixed;bottom:max(16px,env(safe-area-inset-bottom));right:max(16px,env(safe-area-inset-right));display:flex;flex-direction:column;gap:10px;z-index:1000}
        .cart-button{background:var(--button-bg);color:white;border:none;border-radius:50px;padding:16px 22px;font-size:15px;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.2),0 4px 8px rgba(0,0,0,0.1);display:none;align-items:center;gap:10px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);min-height:52px;backdrop-filter:blur(10px)}
        .cart-button:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 12px 28px rgba(0,0,0,0.25),0 6px 12px rgba(0,0,0,0.15)}
        .cart-button:active{transform:translateY(-1px) scale(1.02)}
        .cart-count{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:white;border-radius:50%;width:24px;height:24px;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:900;box-shadow:0 2px 6px rgba(239,68,68,0.4);border:2px solid white}
        .admin-button{background:var(--button-bg);color:white;border:none;border-radius:50px;padding:16px;font-size:18px;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.2),0 4px 8px rgba(0,0,0,0.1);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:none;min-height:52px;min-width:52px;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
        .admin-button:hover{transform:translateY(-3px) rotate(15deg) scale(1.1);box-shadow:0 12px 28px rgba(0,0,0,0.25),0 6px 12px rgba(0,0,0,0.15)}
        .admin-button:active{transform:translateY(-1px) rotate(0deg) scale(1.05)}
        .help-button{background:linear-gradient(135deg,#6b7280 0%,#374151 100%);color:white;border:none;border-radius:50px;padding:16px;font-size:18px;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.2),0 4px 8px rgba(0,0,0,0.1);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:flex;min-height:52px;min-width:52px;align-items:center;justify-content:center;backdrop-filter:blur(10px)}
        .help-button:hover{transform:translateY(-3px) scale(1.1);box-shadow:0 12px 28px rgba(0,0,0,0.25),0 6px 12px rgba(0,0,0,0.15)}
        .help-button:active{transform:translateY(-1px) scale(1.05)}
        
        .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:2000;padding:max(16px,env(safe-area-inset-top)) max(16px,env(safe-area-inset-right)) max(16px,env(safe-area-inset-bottom)) max(16px,env(safe-area-inset-left));backdrop-filter:blur(8px)}
        .modal-content{background:white;border-radius:var(--radius-lg);padding:24px;max-width:400px;width:100%;max-height:85vh;overflow-y:auto;animation:modalSlideIn 0.4s cubic-bezier(0.4,0,0.2,1);box-shadow:0 20px 40px rgba(0,0,0,0.3),0 8px 16px rgba(0,0,0,0.2);border:1px solid rgba(255,255,255,0.1)}
        @keyframes modalSlideIn{from{opacity:0;transform:translateY(40px) scale(0.95)} to{opacity:1;transform:translateY(0) scale(1)}}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #f0f0f0}
        .modal-title{font-size:18px;font-weight:800;color:var(--text);display:flex;align-items:center;gap:6px}
        .close-modal{background:none;border:none;font-size:24px;cursor:pointer;color:var(--text-light);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;min-height:44px;min-width:44px}
        .close-modal:hover{background:#f0f0f0}
        
        .cart-items{margin-bottom:20px;max-height:250px;overflow-y:auto}
        .cart-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f0f0f0}
        .item-info{flex-grow:1}
        .item-name{font-weight:700;margin-bottom:2px;color:var(--text);font-size:14px}
        .item-price{color:var(--price-color);font-weight:700;font-size:14px}
        .item-actions{display:flex;align-items:center;gap:8px}
        .quantity-controls{display:flex;align-items:center;gap:6px;background:#f8f9fa;border-radius:16px;padding:3px;border:1px solid #e5e7eb}
        .quantity-btn{background:var(--primary);color:white;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:bold;font-size:14px;transition:all 0.2s ease;min-height:44px;min-width:44px}
        .quantity-btn:hover{background:var(--primary-dark)}
        .quantity{font-weight:700;min-width:24px;text-align:center;font-size:14px}
        .remove-item{background:#ef4444;color:white;border:none;border-radius:12px;padding:8px 12px;font-size:12px;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;gap:4px;min-height:44px}
        .remove-item:hover{background:#dc2626}
        
        .cart-total{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-top:12px;border-top:2px solid #e5e7eb;font-size:18px;font-weight:800}
        .form-group{margin-bottom:16px}
        .form-label{display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:14px}
        .form-input{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:12px;font-size:14px;transition:all 0.2s ease;font-weight:500;background:white;min-height:44px}
        .form-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(107,114,128,0.1)}
        .phone-input{font-family:monospace;letter-spacing:1px}
        .checkout-btn{width:100%;background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:white;border:none;border-radius:18px;padding:18px;font-size:16px;font-weight:800;cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);margin-top:12px;box-shadow:0 4px 16px rgba(16,185,129,0.3),0 2px 8px rgba(0,0,0,0.1);min-height:52px;position:relative;overflow:hidden;text-transform:uppercase;letter-spacing:0.5px}
        .checkout-btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width 0.6s ease,height 0.6s ease}
        .checkout-btn:hover::before{width:400px;height:400px}
        .checkout-btn:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(16,185,129,0.4),0 4px 12px rgba(0,0,0,0.15)}
        .checkout-btn:active{transform:translateY(-1px)}
        .checkout-btn:disabled{background:linear-gradient(135deg,#9ca3af 0%,#6b7280 100%);cursor:not-allowed;transform:none;box-shadow:0 2px 4px rgba(0,0,0,0.1);opacity:0.6}
        .checkout-btn:disabled::before{display:none}
        
        .empty-cart{text-align:center;padding:30px 16px;color:var(--text-light)}
        .empty-cart i{font-size:40px;color:#d1d5db;margin-bottom:12px}
        .success-state{text-align:center;padding:24px 16px}
        .success-icon{font-size:50px;color:#10b981;margin-bottom:16px}
        .success-title{font-size:20px;font-weight:800;margin-bottom:8px;color:var(--text)}
        .success-message{color:var(--text-light);margin-bottom:20px;line-height:1.4;font-size:14px}
        
        .loading{text-align:center;padding:30px 16px;color:var(--text-light)}
        .loading-spinner{border:3px solid #f3f3f3;border-top:3px solid var(--primary);border-radius:50%;width:32px;height:32px;animation:spin 1s linear infinite;margin:0 auto 16px}
        @keyframes spin{0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)}}
        
        .admin-panel{display:none;background:var(--bg);min-height:100vh;position:relative}
        .admin-header{background:var(--header-bg);color:white;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:var(--border);box-shadow:0 2px 8px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100}
        .admin-title{font-size:20px;font-weight:800;display:flex;align-items:center;gap:8px;text-shadow:0 2px 4px rgba(0,0,0,0.2)}
        .admin-switch{background:rgba(255,255,255,0.25);border:2px solid rgba(255,255,255,0.4);color:white;padding:10px 16px;border-radius:14px;font-weight:700;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:8px;font-size:14px;min-height:44px;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
        .admin-switch:hover{background:rgba(255,255,255,0.35);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
        .admin-switch:active{transform:translateY(0)}
        
        .admin-tabs{display:flex;gap:8px;padding:14px 16px;background:linear-gradient(180deg,var(--bg-secondary) 0%,#f1f5f9 100%);border-bottom:var(--border);overflow-x:auto;scrollbar-width:thin;scrollbar-color:var(--primary-light) transparent;position:sticky;top:72px;z-index:99;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
        .admin-tabs::-webkit-scrollbar{height:4px}
        .admin-tabs::-webkit-scrollbar-track{background:transparent}
        .admin-tabs::-webkit-scrollbar-thumb{background:var(--primary-light);border-radius:2px}
        .admin-tab{padding:12px 16px;border:2px solid #e5e7eb;border-radius:14px;background:white;color:var(--text);font-weight:700;white-space:nowrap;cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);font-size:13px;display:flex;align-items:center;gap:6px;flex-shrink:0;min-height:44px;box-shadow:0 2px 4px rgba(0,0,0,0.05);position:relative;overflow:hidden}
        .admin-tab::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left 0.5s ease}
        .admin-tab:hover::before{left:100%}
        .admin-tab.active{background:var(--button-bg);color:white;border-color:var(--primary-dark);box-shadow:0 4px 12px rgba(107,114,128,0.3);transform:translateY(-2px)}
        .admin-tab.active::before{display:none}
        .admin-content{padding:20px 16px;max-width:100%;overflow-x:hidden}
        .admin-tab-content{display:none;animation:fadeIn 0.3s ease}
        .admin-tab-content.active{display:block}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:24px}
        .stat-card{background:linear-gradient(135deg,white 0%,#fafafa 100%);padding:20px 16px;border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,0.08),0 2px 4px rgba(0,0,0,0.04);text-align:center;border-left:4px solid var(--primary);transition:all 0.3s ease;position:relative;overflow:hidden}
        .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--button-bg);transform:scaleX(0);transition:transform 0.3s ease}
        .stat-card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.12),0 4px 8px rgba(0,0,0,0.06)}
        .stat-card:hover::before{transform:scaleX(1)}
        .stat-value{font-size:24px;font-weight:900;color:#000000;margin-bottom:6px;letter-spacing:-0.5px}
        .stat-label{color:var(--text-light);font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
        
        .product-form{background:linear-gradient(135deg,white 0%,#fafafa 100%);padding:20px;border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,0.08),0 2px 4px rgba(0,0,0,0.04);margin-bottom:20px;border:var(--border);transition:all 0.3s ease}
        .product-form:hover{box-shadow:0 6px 16px rgba(0,0,0,0.12),0 3px 6px rgba(0,0,0,0.06)}
        .form-title{font-size:17px;font-weight:800;margin-bottom:16px;color:var(--text);display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px;border-radius:8px;transition:all 0.2s ease}
        .form-title:hover{background:rgba(107,114,128,0.05)}
        .form-title i{transition:transform 0.3s cubic-bezier(0.4,0,0.2,1)}
        .form-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px }
        @media(max-width:480px){.form-row{grid-template-columns:1fr}}
        .form-full { grid-column:1/-1 }
        .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px;flex-wrap:wrap}
        .collapsible-content{max-height:0;overflow:hidden;transition:max-height 0.4s cubic-bezier(0.4,0,0.2,1),opacity 0.3s ease}
        .collapsible-content.expanded{max-height:2000px;opacity:1}
        
        .search-box{background:linear-gradient(135deg,white 0%,#fafafa 100%);padding:16px;border-radius:var(--radius);box-shadow:0 4px 12px rgba(0,0,0,0.08),0 2px 4px rgba(0,0,0,0.04);margin-bottom:16px;border:var(--border)}
        .search-input{width:100%;padding:14px 16px;border:2px solid #e5e7eb;border-radius:12px;font-size:14px;min-height:48px;transition:all 0.3s ease;background:white;font-weight:500}
        .search-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(107,114,128,0.1);transform:scale(1.01)}
        
        .filter-buttons{display:flex;gap:8px;margin-top:12px;overflow-x:auto;scrollbar-width:thin;scrollbar-color:var(--primary-light) transparent}
        .filter-buttons::-webkit-scrollbar{height:4px}
        .filter-buttons::-webkit-scrollbar-track{background:transparent}
        .filter-buttons::-webkit-scrollbar-thumb{background:var(--primary-light);border-radius:2px}
        .filter-btn{padding:10px 16px;border:2px solid #e5e7eb;border-radius:12px;background:white;color:var(--text);font-weight:700;cursor:pointer;white-space:nowrap;font-size:12px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);flex-shrink:0;min-height:44px;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
        .filter-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.1);border-color:var(--primary-light)}
        .filter-btn.active{background:var(--button-bg);color:white;border-color:var(--primary-dark);box-shadow:0 4px 12px rgba(107,114,128,0.3);transform:translateY(-2px)}
        
        .admin-table-container{background:white;border-radius:var(--radius);overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08),0 2px 4px rgba(0,0,0,0.04);margin-bottom:20px;border:var(--border);max-height:500px;overflow-y:auto;overflow-x:auto;position:relative}
        .admin-table-container::-webkit-scrollbar{width:8px;height:8px}
        .admin-table-container::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px}
        .admin-table-container::-webkit-scrollbar-thumb{background:var(--primary-light);border-radius:4px}
        .admin-table-container::-webkit-scrollbar-thumb:hover{background:var(--primary)}
        .admin-table{width:100%;border-collapse:collapse;min-width:600px}
        .table-header{background:linear-gradient(180deg,#f8fafc 0%,#f1f5f9 100%);border-bottom:2px solid #e5e7eb;font-weight:800;font-size:13px;color:var(--text);position:sticky;top:0;z-index:10;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
        .table-header th{padding:14px 10px;text-align:left;border-bottom:2px solid #e5e7eb;white-space:nowrap;text-transform:uppercase;letter-spacing:0.5px;font-size:11px}
        .table-row td{padding:14px 10px;border-bottom:1px solid #f0f0f0;font-size:13px;color:var(--text-light);transition:all 0.2s ease;white-space:nowrap}
        .table-row{transition:all 0.2s ease}
        .table-row:hover{background:linear-gradient(90deg,#f8f9fa 0%,#f1f5f9 100%);transform:scale(1.01)}
        .table-row:last-child td{border-bottom:none}
        
        .status-badge{padding:6px 10px;border-radius:8px;font-size:10px;font-weight:600;text-align:center}
        .btn{padding:12px 18px;border:none;border-radius:12px;cursor:pointer;font-weight:700;font-size:13px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:inline-flex;align-items:center;gap:6px;min-height:44px;box-shadow:0 2px 6px rgba(0,0,0,0.1);position:relative;overflow:hidden}
        .btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width 0.6s ease,height 0.6s ease}
        .btn:hover::before{width:300px;height:300px}
        .btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
        .btn:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,0.1)}
        .btn-primary{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:white}
        .btn-secondary{background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);color:white}
        .btn-danger{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:white}
        .btn-sm{padding:10px 14px;font-size:12px}
        .btn-lg{padding:14px 22px;font-size:15px}
        
        .toast{position:fixed;top:16px;left:50%;transform:translateX(-50%) translateY(-80px);color:white;padding:12px 18px;border-radius:20px;box-shadow:var(--shadow-lg);z-index:3000;transition:all 0.3s ease;font-weight:600;display:flex;align-items:center;gap:8px;opacity:0;backdrop-filter:blur(10px);font-size:14px}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .toast.success{background:linear-gradient(135deg,#10b981 0%,#059669 100%)}
        .toast.error{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%)}
        .toast.info{background:linear-gradient(135deg,#6b7280 0%,#374151 100%)}
        
        .delivery-banner{background:linear-gradient(135deg,var(--primary-light) 0%,#e5e7eb 100%);padding:12px 16px;margin:0 16px 16px;border-radius:var(--radius);border-left:3px solid var(--primary);display:flex;align-items:center;gap:8px;font-weight:600;color:var(--text);font-size:13px}
        .delivery-banner i{color:var(--primary);font-size:16px}
        
        .badge{display:inline-flex;align-items:center;gap:2px;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}
        .badge.new{background:#fef3c7;color:#92400e}
        .badge.confirmed{background:#dbeafe;color:#1e40af}
        .badge.delivered{background:#dcfce7;color:#166534}
        .badge.cancelled{background:#fecaca;color:#991b1b}
        
        .empty-table-message{text-align:center;padding:30px 16px;color:var(--text-light);font-size:14px}
        .role-badge{padding:6px 10px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}
        .role-owner{background:#fee2e2;color:#dc2626}
        .role-admin{background:#dbeafe;color:#1d4ed8}
        
        .settings-group{margin-bottom:16px}
        .settings-label{font-weight:600;margin-bottom:6px;color:var(--text);font-size:14px}
        .settings-hint{font-size:12px;color:var(--text-light);margin-top:4px}
        .checkbox-group{display:flex;align-items:center;gap:8px;margin-bottom:12px}
        .checkbox-label{font-weight:600;color:var(--text);font-size:14px}
        
        .delivery-option{background:white;border:2px solid #e5e7eb;border-radius:12px;padding:12px;margin-bottom:12px;cursor:pointer;transition:all 0.2s ease;min-height:44px}
        .delivery-option.selected{border-color:var(--primary);background:var(--primary-light)}
        .delivery-option-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .delivery-option-title{font-weight:700;font-size:14px}
        .delivery-option-description{font-size:12px;color:var(--text-light)}
        .delivery-price{font-weight:700;color:var(--secondary);font-size:14px}
        
        .admin-actions{display:flex;gap:6px;flex-wrap:wrap}
        .contact-btn{background:linear-gradient(135deg,#6b7280 0%,#374151 100%);color:white;border:none;border-radius:6px;padding:8px 12px;font-size:11px;cursor:pointer;display:flex;align-items:center;gap:4px;min-height:44px}
        
        .settings-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
        .settings-full{grid-column:1/-1}
        .settings-input{width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:10px;font-size:13px;min-height:44px}
        .settings-input:focus{outline:none;border-color:var(--primary)}
        
        .theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
        .theme-option{height:80px;border-radius:12px;cursor:pointer;border:3px solid transparent;transition:all 0.2s ease;position:relative}
        .theme-option.selected{border-color:#10b981}
        .theme-option::after{content:'✓';position:absolute;top:8px;right:8px;background:#10b981;color:white;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;opacity:0;transition:opacity 0.2s ease}
        .theme-option.selected::after{opacity:1}
        
        .pattern-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
        .pattern-option{height:60px;border-radius:12px;cursor:pointer;border:3px solid transparent;transition:all 0.2s ease;position:relative;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px;color:var(--text)}
        .pattern-option.selected{border-color:#10b981}
        .pattern-option::after{content:'✓';position:absolute;top:8px;right:8px;background:#10b981;color:white;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;opacity:0;transition:opacity 0.2s ease}
        .pattern-option.selected::after{opacity:1}
        .pattern-option.dots{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse"><circle cx="15" cy="15" r="5" fill="%236b7280" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>')}
        .pattern-option.lines{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="lines" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><line x1="0" y1="0" x2="0" y2="20" stroke="%236b7280" stroke-width="2" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23lines)"/></svg>')}
        .pattern-option.flowers{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="flowers" x="0" y="0" width="25" height="25" patternUnits="userSpaceOnUse"><path d="M12.5,5 C10,5 7.5,7.5 7.5,10 C7.5,12.5 10,15 12.5,15 C15,15 17.5,12.5 17.5,10 C7.5,7.5 15,5 12.5,5 Z" fill="%236b7280" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23flowers)"/></svg>')}
        .pattern-option.hearts{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="hearts" x="0" y="0" width="25" height="25" patternUnits="userSpaceOnUse"><path d="M12.5,6 C10,6 7.5,8.5 7.5,11 C7.5,13.5 10,16 12.5,16 C15,16 17.5,13.5 17.5,11 C17.5,8.5 15,6 12.5,6 Z" fill="%236b7280" opacity="0.1" transform="rotate(45 12.5 11)"/></pattern></defs><rect width="100" height="100" fill="url(%23hearts)"/></svg>')}
        .pattern-option.stars{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><polygon points="10,2 12,8 18,8 13,12 15,18 10,14 5,18 7,12 2,8 8,8" fill="%236b7280" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>')}
        .pattern-option.waves{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="waves" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse"><path d="M0,15 Q15,5 30,15 T60,15 T90,15 T120,15" stroke="%236b7280" stroke-width="2" fill="none" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23waves)"/></svg>')}
        .pattern-option.geometric{background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="geometric" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><rect x="0" y="0" width="10" height="10" fill="%236b7280" opacity="0.1"/><rect x="10" y="10" width="10" height="10" fill="%236b7280" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23geometric)"/></svg>')}
        
        .help-section{display:none}
        .help-section.active{display:block}
        .help-tabs{display:flex;gap:6px;padding:12px;background:var(--bg-secondary);border-bottom:var(--border);overflow-x:auto}
        .help-tab{padding:10px 14px;border:2px solid #e5e7eb;border-radius:12px;background:white;color:var(--text);font-weight:600;white-space:nowrap;cursor:pointer;transition:all 0.2s ease;font-size:12px;flex-shrink:0;min-height:44px}
        .help-tab.active{background:var(--button-bg);color:white;border-color:var(--primary)}
        .help-content{padding:16px}
        .help-item{margin-bottom:20px}
        .help-item h3{font-size:16px;font-weight:700;margin-bottom:8px;color:var(--text)}
        .help-item p{font-size:14px;color:var(--text-light);line-height:1.5;margin-bottom:8px}
        .help-item ul{margin-left:20px;color:var(--text-light)}
        .help-item li{font-size:14px;margin-bottom:4px;line-height:1.4}
        
        .order-summary{background:#f8f9fa;padding:16px;border-radius:var(--radius);margin-bottom:16px;border:var(--border)}
        .summary-row{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px}
        .summary-row.total{font-weight:700;font-size:16px;border-top:1px solid #e5e7eb;padding-top:8px;margin-top:8px}
        
        .sortable-handle{cursor:grab;padding:8px;color:var(--text-light);min-height:44px;min-width:44px;display:flex;align-items:center;justify-content:center}
        .sortable-handle:active{cursor:grabbing}
        .sortable-ghost{opacity:0.4}
        
        .quick-actions{display:flex;gap:10px;padding:16px;background:linear-gradient(180deg,var(--bg-secondary) 0%,#f1f5f9 100%);border-bottom:var(--border);overflow-x:auto;scrollbar-width:thin;scrollbar-color:var(--primary-light) transparent}
        .quick-actions::-webkit-scrollbar{height:4px}
        .quick-actions::-webkit-scrollbar-track{background:transparent}
        .quick-actions::-webkit-scrollbar-thumb{background:var(--primary-light);border-radius:2px}
        .quick-action-btn{padding:14px 18px;background:white;border:2px solid #e5e7eb;border-radius:14px;color:var(--text);font-weight:700;white-space:nowrap;cursor:pointer;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);display:flex;align-items:center;gap:8px;font-size:14px;flex-shrink:0;min-height:44px;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
        .quick-action-btn:hover{background:var(--primary-light);border-color:var(--primary);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.12)}
        .quick-action-btn.primary{background:var(--button-bg);color:white;border-color:var(--primary-dark);box-shadow:0 4px 12px rgba(107,114,128,0.3)}
        .quick-action-btn.primary:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(107,114,128,0.4)}
        
        .help-view{display:none;background:var(--bg);min-height:100vh}
        .help-header{background:var(--header-bg);color:white;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:var(--border)}
        .help-title{font-size:18px;font-weight:700}
        .help-back{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:8px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;gap:6px;font-size:13px;min-height:44px}
        .help-back:hover{background:rgba(255,255,255,0.3)}
        
        .pagination{display:flex;justify-content:center;gap:8px;margin-top:16px}
        .page-btn{padding:10px 14px;border:1px solid #e5e7eb;border-radius:8px;background:white;color:var(--text);cursor:pointer;font-size:12px;font-weight:600;min-height:44px}
        .page-btn.active{background:var(--primary);color:white;border-color:var(--primary)}
        .page-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .dangerous-section{background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%);border:2px solid #fca5a5;border-radius:var(--radius);padding:16px;margin-bottom:16px}
        .dangerous-title{color:#dc2626;font-size:16px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .dangerous-description{color:#991b1b;font-size:13px;margin-bottom:12px}
        .dangerous-input{width:100%;padding:12px;border:2px solid #fca5a5;border-radius:10px;font-size:13px;margin-bottom:12px;min-height:44px}
        .dangerous-btn{background:linear-gradient(135deg,#dc2626 0%,#b91c1c 100%);color:white;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer;transition:all 0.2s ease;min-height:44px}
        .dangerous-btn:hover{transform:translateY(-2px)}
        
        .promo-form{background:white;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:16px;border:var(--border)}
        .promo-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
        .promo-full{grid-column:1/-1}
        
        .move-buttons{display:flex;gap:4px}
        .move-btn{padding:6px;border:1px solid #e5e7eb;border-radius:6px;background:white;cursor:pointer;color:var(--text-light);min-height:44px;min-width:44px;display:flex;align-items:center;justify-content:center}
        .move-btn:hover{background:#f8f9fa}
        
        .promo-field{display:flex;align-items:center;gap:8px}
        .promo-discount{display:flex;align-items:center;gap:4px}

        .status-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:3000;justify-content:center;align-items:center;padding:16px}
        .status-modal-content{background:white;border-radius:var(--radius-lg);padding:20px;max-width:320px;width:100%;box-shadow:var(--shadow-lg)}
        .status-option{padding:12px 16px;border:2px solid #e5e7eb;border-radius:10px;margin-bottom:8px;cursor:pointer;transition:all 0.2s ease;min-height:44px}
        .status-option:hover{background:#f8f9fa}
        .status-option.selected{border-color:var(--primary);background:var(--primary-light)}

        .dropdown { width:100%; position:relative }
        .dropdown-toggle { width:100%; padding:14px; border:2px solid #e5e7eb; border-radius:12px; background:white; text-align:left; cursor:pointer; display:flex; justify-content:space-between; align-items:center; min-height:48px; font-weight:500; transition:all 0.2s ease }
        .dropdown-toggle:hover { border-color:#9ca3af }
        .dropdown-menu { display:none; position:absolute; top:100%; left:0; right:0; background:white; border:2px solid #e5e7eb; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.15); z-index:1000; max-height:200px; overflow-y:auto; margin-top:4px }
        .dropdown-menu.show { display:block; animation:dropdownSlide 0.2s ease }
        @keyframes dropdownSlide{from{opacity:0;transform:translateY(-10px)} to{opacity:1;transform:translateY(0)}}
        .dropdown-item { padding:14px 16px; cursor:pointer; transition:all 0.2s ease; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; gap:8px; min-height:48px }
        .dropdown-item:last-child { border-bottom:none }
        .dropdown-item:hover { background:#f8f9fa }
        .dropdown-item.selected { background:#f3f4f6; color:#374151 }
        .form-input-placeholder { font-size:12px; color:#6b7280; margin-top:6px; line-height:1.4 }
        
        .category-form{background:white;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:16px;border:var(--border)}
        .icon-scroll-container{max-height:200px;overflow-y:auto;border:1px solid #e5e7eb;border-radius:8px;padding:8px;margin-top:8px}
        .icon-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
        .icon-option{padding:12px;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;text-align:center;transition:all 0.2s ease;min-height:44px}
        .icon-option.selected{border-color:var(--primary);background:var(--primary-light)}
        .icon-option i{font-size:18px;margin-bottom:4px}
        
        .product-status{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700}
        .status-active{background:#dcfce7;color:#166534}
        .status-inactive{background:#fecaca;color:#dc2626;text-decoration:line-through}
        
        .table-image{width:40px;height:40px;border-radius:8px;object-fit:cover}
        .table-product-image{width:60px;height:60px;border-radius:8px;object-fit:cover}
        
        .skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s infinite}
        @keyframes loading{0%{background-position:200% 0} 100%{background-position:-200% 0}}
        .skeleton-text{height:12px;border-radius:4px;margin-bottom:8px}
        .skeleton-image{width:100%;height:180px;border-radius:var(--radius)}
        
        .dark-mode{display:none}

        .edit-category-form{background:white;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:16px;border:var(--border)}
        .edit-category-form .form-title{margin-bottom:16px}
        
        .collapsible-section{margin-bottom:16px}
        .collapsible-header{background:white;padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);border:var(--border);cursor:pointer;display:flex;justify-content:space-between;align-items:center}
        .collapsible-header h3{font-size:16px;font-weight:700;color:var(--text);margin:0}
        .collapsible-header i{transition:transform 0.3s ease}
        .collapsible-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease}
        .collapsible-section.expanded .collapsible-content{max-height:2000px}
        .collapsible-section.expanded .collapsible-header i{transform:rotate(180deg)}
        
        .confirmation-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:4000;justify-content:center;align-items:center;padding:16px;backdrop-filter:blur(5px)}
        .confirmation-content{background:white;border-radius:var(--radius-lg);padding:20px;max-width:320px;width:100%;box-shadow:var(--shadow-lg);text-align:center}
        .confirmation-icon{font-size:48px;color:#ef4444;margin-bottom:16px}
        .confirmation-title{font-size:18px;font-weight:700;margin-bottom:8px;color:var(--text)}
        .confirmation-message{color:var(--text-light);margin-bottom:20px;line-height:1.4}
        .confirmation-actions{display:flex;gap:12px;justify-content:center}
        .confirmation-btn{flex:1;padding:12px 16px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.2s ease;min-height:44px}
        .confirmation-btn.cancel{background:#6b7280;color:white}
        .confirmation-btn.confirm{background:#ef4444;color:white}
        .confirmation-btn:hover{transform:translateY(-1px)}
        
        .product-inactive{background:#fef2f2;border:2px solid #fecaca}
        .category-inactive{background:#fef2f2;border:2px solid #fecaca}
        
        .form-input{width:100%;padding:14px;border:2px solid #e5e7eb;border-radius:12px;font-size:14px;transition:all 0.2s ease;background:white;min-height:48px;font-weight:500}
        .product-no-category{border-left:3px solid #6b7280;opacity:0.8}
        .admin-tab-content{display:none}.admin-tab-content.active{display:block}
        .dangerous-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:4000;padding:16px;backdrop-filter:blur(5px)}
        .dangerous-modal-content{background:white;border-radius:var(--radius-lg);padding:20px;max-width:320px;width:100%;box-shadow:var(--shadow-lg);text-align:center}
        .dangerous-modal-icon{font-size:48px;color:#ef4444;margin-bottom:16px}
        .dangerous-modal-title{font-size:18px;font-weight:700;margin-bottom:8px;color:var(--text)}
        .dangerous-modal-message{color:var(--text-light);margin-bottom:20px;line-height:1.4}
        .dangerous-modal-actions{display:flex;gap:12px;justify-content:center}
        .dangerous-modal-btn{flex:1;padding:12px 16px;border:none;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.2s ease;min-height:44px}
        .dangerous-modal-btn.cancel{background:#6b7280;color:white}
        .dangerous-modal-btn.confirm{background:#ef4444;color:white}
        .dangerous-modal-btn:hover{transform:translateY(-1px)}

        #loadingScreen{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#ffffff;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10000;transition:opacity 0.8s ease,visibility 0.8s ease;}
        .loading-logo{width:150px;height:150px;border-radius:50%;object-fit:cover;margin-bottom:25px;box-shadow:0 8px 20px rgba(0,0,0,0.15);border:4px solid white;}
        .loading-title{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;font-size:18px;font-weight:600;color:#333;text-align:center;margin-bottom:40px;max-width:300px;line-height:1.4;padding:0 20px;}
        .loading-container{width:80%;max-width:350px;position:absolute;bottom:60px;}
        .progress-track{width:100%;height:30px;background-color:white;border:3px solid #000;border-radius:50px;overflow:hidden;position:relative;}
        .progress-fill{height:100%;width:0;background-color:hsl(98,23%,36%);background-image:linear-gradient(45deg,rgba(255,255,255,0.2) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.2) 50%,rgba(255,255,255,0.2) 75%,transparent 75%,transparent);background-size:30px 30px;box-shadow:inset 0 2px 8px rgba(0,0,0,0.3);animation:fill-bar 3s linear forwards,move-stripes 1s linear infinite;}
        @keyframes fill-bar{from{width:0%;}to{width:100%;}}
        @keyframes move-stripes{from{background-position:0 0;}to{background-position:30px 0;}}

        #ai-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(1200px 800px at 20% 0%, rgba(59,130,246,0.20), transparent 55%),radial-gradient(900px 700px at 80% 0%, rgba(168,85,247,0.20), transparent 55%),rgba(10,10,14,0.92);z-index:10000;flex-direction:column;backdrop-filter:blur(14px);transition:all 0.3s ease}
        #ai-modal.active{display:flex}
        #ai-close{position:absolute;top:14px;right:14px;width:44px;height:44px;border-radius:14px;background:rgba(255,255,255,0.10);border:1px solid rgba(255,255,255,0.18);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px;color:rgba(255,255,255,0.92);z-index:10001;box-shadow:0 10px 25px rgba(0,0,0,0.35)}
        #ai-close:hover{background:rgba(255,255,255,0.14)}
        #ai-chat-container{flex:1;overflow-y:auto;padding:68px 16px 110px;max-width:900px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:12px}
        #ai-chat-container::-webkit-scrollbar{width:8px}
        #ai-chat-container::-webkit-scrollbar-track{background:transparent}
        #ai-chat-container::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.18);border-radius:6px}
        #ai-input-area{position:absolute;bottom:0;left:0;width:100%;padding:14px 14px max(14px,env(safe-area-inset-bottom));background:linear-gradient(180deg, rgba(10,10,14,0) 0%, rgba(10,10,14,0.85) 35%, rgba(10,10,14,0.92) 100%);display:flex;justify-content:center}
        #ai-input-wrapper{max-width:900px;width:100%;display:flex;gap:10px;background:rgba(255,255,255,0.08);padding:10px;border-radius:18px;border:1px solid rgba(255,255,255,0.16);box-shadow:0 18px 40px rgba(0,0,0,0.45)}
        #ai-input-wrapper input{flex:1;border:none;background:transparent;padding:12px 14px;outline:none;font-size:15px;color:rgba(255,255,255,0.92)}
        #ai-input-wrapper input::placeholder{color:rgba(255,255,255,0.55)}
        #ai-input-wrapper button{background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%);color:white;border:none;padding:12px 18px;border-radius:14px;cursor:pointer;font-weight:800;letter-spacing:0.2px;box-shadow:0 10px 25px rgba(59,130,246,0.30)}
        #ai-input-wrapper button:hover{filter:brightness(1.06)}
        .ai-msg{max-width:88%;padding:12px 14px;border-radius:18px;font-size:14px;line-height:1.55;word-wrap:break-word;border:1px solid rgba(255,255,255,0.10)}
        .ai-msg.user{align-self:flex-end;background:linear-gradient(135deg,rgba(59,130,246,0.35) 0%,rgba(139,92,246,0.30) 100%);color:rgba(255,255,255,0.95);border-bottom-right-radius:6px}
        .ai-msg.bot{align-self:flex-start;background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.92);border-bottom-left-radius:6px}
        .ai-msg strong{font-weight:800;color:rgba(255,255,255,0.98)}
        .ai-msg br{display:block;margin:6px 0}
        .launch-btn{background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%);color:white;padding:16px 22px;border-radius:16px;border:none;cursor:pointer;font-weight:900;display:flex;align-items:center;gap:10px;margin:20px auto;transition:transform 0.2s;box-shadow:0 14px 30px rgba(59,130,246,0.25)}
        .launch-btn:hover{transform:scale(1.03)}
    </style>
</head>
<body>
    <div class="snow-container" id="snowContainer"></div>
    <div class="rain-container" id="rainContainer"></div>
    <div class="confetti-container" id="confettiContainer"></div>
    <div class="night-container" id="nightContainer"></div>

    <div id="loadingScreen">
        <img src="https://raw.githubusercontent.com/Fallout-rtg/flowershop/main/ArtFlora.jpg" alt="АртФлора" class="loading-logo">
        <div class="loading-title">АртФлора - когда цветы становятся искусством!</div>
        <div class="loading-container">
            <div class="progress-track">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <div class="toast" id="toast">
            <i class="fas fa-check-circle" id="toastIcon"></i>
            <span id="toastMessage">Добавлено</span>
        </div>

        <div class="customer-view" id="customerView">
            <div class="header dots" id="shopHeader">
                <div class="header-content">
                    <h1 id="shopName">🌸 Flower Shop</h1>
                    <p id="shopSubtitle">Элитные букеты с доставкой по Ярославлю</p>
                    <div class="delivery-info">
                        <i class="fas fa-shipping-fast"></i>
                        <span id="deliveryInfoText">Доставка 200₽ • Бесплатно от 3000₽</span>
                    </div>
                </div>
            </div>

            <div class="delivery-banner">
                <i class="fas fa-clock"></i>
                <span id="workingHoursText">Доставляем ежедневно с 9:00 до 20:00</span>
            </div>

            <div class="categories" id="categoriesContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Загружаем категории...</div>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Загружаем каталог...</div>
                </div>
            </div>
        </div>

        <div class="admin-panel" id="adminPanel">
            <div class="admin-header">
                <div class="admin-title">🛠️ Панель управления</div>
                <button class="admin-switch" onclick="switchToCustomerView()">
                    <i class="fas fa-store"></i> Магазин
                </button>
            </div>

            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="dashboard">
                    <i class="fas fa-chart-bar"></i>Главная
                </div>
                <div class="admin-tab" data-tab="products">
                    <i class="fas fa-shopping-bag"></i>Товары
                </div>
                <div class="admin-tab" data-tab="orders">
                    <i class="fas fa-clipboard-list"></i>Заказы
                </div>
                <div class="admin-tab" data-tab="promocodes">
                    <i class="fas fa-tag"></i>Промокоды
                </div>
                <div class="admin-tab" data-tab="admins">
                    <i class="fas fa-users"></i>Админы
                </div>
                <div class="admin-tab" data-tab="settings">
                    <i class="fas fa-cog"></i>Настройки
                </div>
                <div class="admin-tab" data-tab="help">
                    <i class="fas fa-question-circle"></i>Помощь
                </div>
                <div class="admin-tab" data-tab="export">
                    <i class="fas fa-file-export"></i>Экспорт
                </div>
                <div class="admin-tab" data-tab="ai">
                    <i class="fas fa-robot"></i> AI Помощник
                </div>
                <div class="admin-tab" data-tab="dangerous" id="dangerousTabButton" style="display: none;">
                    <i class="fas fa-skull-crossbones"></i>Опасные действия
                </div>
            </div>

            <div class="admin-content">
                <div class="admin-tab-content active" id="dashboardTab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalOrders">0</div>
                            <div class="stat-label">Всего заказов</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="completedOrders">0</div>
                            <div class="stat-label">Завершено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalRevenue">0 ₽</div>
                            <div class="stat-label">Реальная выручка</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="potentialRevenue">0 ₽</div>
                            <div class="stat-label">Потенциальная</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalProducts">0</div>
                            <div class="stat-label">Товаров</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activePromocodes">0</div>
                            <div class="stat-label">Промокодов</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-action-btn primary" onclick="loadAdminData()">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                        <button class="quick-action-btn" onclick="showTab('products')">
                            <i class="fas fa-plus"></i> Добавить товар
                        </button>
                        <button class="quick-action-btn" onclick="showTab('orders')">
                            <i class="fas fa-eye"></i> Просмотр заказов
                        </button>
                    </div>
                </div>
                
                <div class="admin-tab-content" id="productsTab">
                    <div class="product-form">
                        <div class="form-title" onclick="toggleProductForm()">
                            <i class="fas fa-chevron-down" id="productFormIcon"></i>
                            ➕ Добавить новый товар
                        </div>
                        <div class="collapsible-content" id="productFormContent">
                            <div class="form-row">
                                <input type="text" id="productName" placeholder="Название товара" class="form-input">
                                <input type="number" id="productPrice" placeholder="Цена в рублях" class="form-input">
                            </div>
                            <div class="form-row">
                                <input type="text" id="productImage" placeholder="Ссылка на изображение" class="form-input">
                                <div class="dropdown">
                                    <div class="dropdown-toggle" id="categoryDropdownToggle">
                                        <span>Выберите категорию</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-menu" id="categoryDropdown">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row form-full">
                                <textarea id="productDescription" placeholder="Подробное описание товара" class="form-input" rows="2"></textarea>
                            </div>
                            <div class="form-row form-full">
                                <textarea id="productFact" placeholder="Интересный факт о цветах" class="form-input" rows="2"></textarea>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="productFeatured">
                                <label class="checkbox-label">Хит товар (бейдж "Хит")</label>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary btn-lg" onclick="addProduct()">
                                    <i class="fas fa-save"></i> Сохранить товар
                                </button>
                                <button class="btn btn-secondary" onclick="resetProductForm()">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="category-form">
                        <div class="form-title" onclick="toggleCategoryForm()">
                            <i class="fas fa-chevron-down" id="categoryFormIcon"></i>
                            📁 Управление категориями
                        </div>
                        <div class="collapsible-content" id="categoryFormContent">
                            <div class="form-row">
                                <input type="text" id="categoryName" placeholder="Название категории" class="form-input">
                                <input type="text" id="categorySlug" placeholder="Slug (англ.)" class="form-input">
                            </div>
                            <div class="form-full">
                                <label class="form-label">Выберите иконку:</label>
                                <div class="icon-scroll-container">
                                    <div class="icon-grid" id="iconGrid">
                                        <div class="icon-option" data-icon="fas fa-heart">
                                            <i class="fas fa-heart"></i>
                                            <div>Сердце</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-star">
                                            <i class="fas fa-star"></i>
                                            <div>Звезда</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-sun">
                                            <i class="fas fa-sun"></i>
                                            <div>Солнце</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-moon">
                                            <i class="fas fa-moon"></i>
                                            <div>Луна</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-leaf">
                                            <i class="fas fa-leaf"></i>
                                            <div>Лист</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-spa">
                                            <i class="fas fa-spa"></i>
                                            <div>Цветок</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-seedling">
                                            <i class="fas fa-seedling"></i>
                                            <div>Росток</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-feather">
                                            <i class="fas fa-feather"></i>
                                            <div>Перо</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-cloud">
                                            <i class="fas fa-cloud"></i>
                                            <div>Облако</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-fire">
                                            <i class="fas fa-fire"></i>
                                            <div>Огонь</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-water">
                                            <i class="fas fa-tint"></i>
                                            <div>Вода</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-snowflake">
                                            <i class="fas fa-snowflake"></i>
                                            <div>Снег</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-tree">
                                            <i class="fas fa-tree"></i>
                                            <div>Дерево</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-mountain">
                                            <i class="fas fa-mountain"></i>
                                            <div>Гора</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-umbrella">
                                            <i class="fas fa-umbrella"></i>
                                            <div>Зонт</div>
                                        </div>
                                        <div class="icon-option" data-icon="fas fa-gem">
                                            <i class="fas fa-gem"></i>
                                            <div>Кристалл</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" onclick="addCategory()">
                                    <i class="fas fa-plus"></i> Создать категорию
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="collapsible-section" id="productsSection">
                        <div class="collapsible-header" onclick="toggleSection('productsSection')">
                            <h3><i class="fas fa-shopping-bag"></i> Товары</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapsible-content">
                            <div class="search-box">
                                <input type="text" id="productSearch" placeholder="🔍 Поиск по названию, описанию или категории..." class="search-input" onkeyup="filterProducts()">
                                <div class="filter-buttons">
                                    <button class="filter-btn active" data-status="all">Все товары</button>
                                    <button class="filter-btn" data-status="active">Активные</button>
                                    <button class="filter-btn" data-status="inactive">Неактивные</button>
                                </div>
                            </div>

                            <div class="admin-table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr class="table-header">
                                            <th>ID</th>
                                            <th>Изобр.</th>
                                            <th>Название</th>
                                            <th>Цена</th>
                                            <th>Категория</th>
                                            <th>Статус</th>
                                            <th>Порядок</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsList">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="collapsible-section" id="categoriesSection">
                        <div class="collapsible-header" onclick="toggleSection('categoriesSection')">
                            <h3><i class="fas fa-folder"></i> Категории</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapsible-content">
                            <div class="admin-table-container">
                                <table class="admin-table">
                                    <thead>
                                        <tr class="table-header">
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Slug</th>
                                            <th>Иконка</th>
                                            <th>Статус</th>
                                            <th>Порядок</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody id="categoriesList">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="admin-tab-content" id="ordersTab">
                    <div class="search-box">
                        <input type="text" id="orderSearch" placeholder="🔍 Поиск по ID, имени или телефону..." class="search-input" onkeyup="filterOrders()">
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-status="all">Все заказы</button>
                            <button class="filter-btn" data-status="1">Новые</button>
                            <button class="filter-btn" data-status="2">Подтверждены</button>
                            <button class="filter-btn" data-status="3">Собираются</button>
                            <button class="filter-btn" data-status="4">В пути</button>
                            <button class="filter-btn" data-status="5">Доставлены</button>
                            <button class="filter-btn" data-status="6">Отменены</button>
                        </div>
                    </div>

                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr class="table-header">
                                    <th>ID</th>
                                    <th>Клиент</th>
                                    <th>Сумма</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="ordersList">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" id="ordersPagination"></div>
                </div>

                <div class="admin-tab-content" id="promocodesTab">
                    <div class="promo-form" id="promoFormContainer">
                        <div class="form-title" onclick="togglePromoForm()">
                            <i class="fas fa-chevron-down" id="promoFormIcon"></i>
                            🏷️ Создать промокод
                        </div>
                        <div class="collapsible-content" id="promoFormContent">
                            <div class="promo-row">
                                <input type="text" id="promoCode" placeholder="Код промокода" class="form-input">
                                <div class="dropdown">
                                    <div class="dropdown-toggle" id="discountTypeDropdownToggle">
                                        <span>Тип скидки</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-menu" id="discountTypeDropdown">
                                        <div class="dropdown-item" data-value="percentage">Процентная</div>
                                        <div class="dropdown-item" data-value="fixed">Фиксированная</div>
                                    </div>
                                </div>
                            </div>
                            <div class="promo-row">
                                <div class="promo-field">
                                    <input type="number" id="promoDiscountValue" placeholder="Значение" class="form-input">
                                    <span id="promoDiscountSuffix">%</span>
                                </div>
                                <input type="number" id="promoMinOrder" placeholder="Мин. сумма" class="form-input">
                            </div>
                            <div class="promo-row">
                                <input type="number" id="promoMaxUses" placeholder="Лимит использований" class="form-input">
                                <input type="date" id="promoValidUntil" class="form-input">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" onclick="addPromocode()">
                                    <i class="fas fa-tag"></i> Создать промокод
                                </button>
                                <button class="btn btn-secondary" onclick="resetPromoForm()">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr class="table-header">
                                    <th>Код</th>
                                    <th>Скидка</th>
                                    <th>Использовано</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="promocodesList">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="admin-tab-content" id="adminsTab">
                    <div class="product-form" id="adminFormContainer">
                        <div class="form-title" onclick="toggleAdminForm()">
                            <i class="fas fa-chevron-down" id="adminFormIcon"></i>
                            👤 Добавить администратора
                        </div>
                        <div class="collapsible-content" id="adminFormContent">
                            <div class="form-row">
                                <input type="text" id="adminTelegramId" placeholder="Telegram ID" class="form-input">
                                <input type="text" id="adminUsername" placeholder="Username (@nickname)" class="form-input">
                            </div>
                            <div class="form-row">
                                <input type="text" id="adminFirstName" placeholder="Имя администратора" class="form-input">
                                <div class="dropdown">
                                    <div class="dropdown-toggle" id="roleDropdownToggle">
                                        <span>Выберите роль</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-menu" id="roleDropdown">
                                        <div class="dropdown-item" data-value="admin">Администратор</div>
                                        <div class="dropdown-item" data-value="owner">Владелец</div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" onclick="addAdmin()">
                                    <i class="fas fa-user-plus"></i> Добавить администратора
                                </button>
                                <button class="btn btn-secondary" onclick="resetAdminForm()">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr class="table-header">
                                    <th>ID</th>
                                    <th>Имя</th>
                                    <th>Username</th>
                                    <th>Роль</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="adminsList">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="admin-tab-content" id="settingsTab">
                    <div class="product-form">
                        <div class="form-title">⚙️ Настройки магазина</div>
                        
                        <div class="settings-group">
                            <div class="settings-label">Основная информация</div>
                            <div class="settings-row">
                                <input type="text" id="shopNameInput" placeholder="Название магазина" class="settings-input">
                                <input type="text" id="shopPhone" placeholder="Телефон" class="settings-input">
                            </div>
                            <div class="settings-full">
                                <input type="text" id="shopSubtitleInput" placeholder="Подзаголовок магазина" class="settings-input">
                            </div>
                            <div class="settings-full">
                                <input type="text" id="shopAddress" placeholder="Адрес магазина" class="settings-input">
                            </div>
                            <div class="settings-full">
                                <textarea id="shopWorkingHours" placeholder="Режим работы" class="settings-input" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-label">Настройки доставки</div>
                            <div class="settings-row">
                                <input type="number" id="deliveryPrice" placeholder="Стоимость доставки" class="settings-input">
                                <input type="number" id="freeDeliveryMin" placeholder="Бесплатно от суммы" class="settings-input">
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-label">Оформление магазина</div>
                            <div class="theme-grid" id="themeGrid"></div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-label">Узор шапки магазина</div>
                            <div class="pattern-grid" id="patternGrid">
                                <div class="pattern-option dots" data-pattern="dots">Горошек</div>
                                <div class="pattern-option lines" data-pattern="lines">Полоски</div>
                                <div class="pattern-option flowers" data-pattern="flowers">Цветочки</div>
                                <div class="pattern-option hearts" data-pattern="hearts">Сердечки</div>
                                <div class="pattern-option stars" data-pattern="stars">Звезды</div>
                                <div class="pattern-option waves" data-pattern="waves">Волны</div>
                                <div class="pattern-option geometric" data-pattern="geometric">Геометрия</div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-label">Визуальные эффекты</div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="snowEffect">
                                <label class="checkbox-label">❄️ Снегопад в каталоге</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="rainEffect">
                                <label class="checkbox-label">🌧️ Дождь в каталоге</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="confettiEffect">
                                <label class="checkbox-label">🎉 Конфетти в каталоге</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="nightEffect">
                                <label class="checkbox-label">🌙 Ночной режим с подсветкой</label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary btn-lg" onclick="saveShopSettings()">
                                <i class="fas fa-save"></i> Сохранить все настройки
                            </button>
                        </div>
                    </div>
                </div>

                <div class="admin-tab-content" id="aiTab">
                    <div class="assistant-tab-content">
                        <button class="launch-btn" onclick="toggleAI(true)">
                            <i class="fas fa-robot"></i> Запустить помощника
                        </button>
                    </div>
                </div>

                <div class="admin-tab-content" id="helpTab">
                    <div class="help-content">
                        <div class="help-item">
                            <h3>📖 Руководство по управлению ботом</h3>
                            <p>Это руководство поможет вам эффективно управлять вашим цветочным магазином через Telegram бота.</p>
                        </div>

                        <div class="help-item">
                            <h3>🛍️ Управление товарами и категориями</h3>
                            <p><strong>Добавление товаров:</strong></p>
                            <ul>
                                <li>Перейдите в раздел "Товары"</li>
                                <li>Нажмите "Добавить новый товар"</li>
                                <li>Заполните все обязательные поля</li>
                                <li>Выберите категорию из выпадающего списка</li>
                                <li>Укажите цену и загрузите изображение</li>
                            </ul>
                            <p><strong>Управление категориями:</strong></p>
                            <ul>
                                <li>Создавайте новые категории с иконками</li>
                                <li>Редактируйте существующие категории</li>
                                <li>Удаляйте ненужные категории</li>
                                <li>Назначайте товарам соответствующие категории</li>
                            </ul>
                            <p><strong>Сортировка товаров:</strong> Используйте фильтры для просмотра активных/неактивных товаров</p>
                        </div>

                        <div class="help-item">
                            <h3>📦 Управление заказами</h3>
                            <p><strong>Просмотр заказы:</strong></p>
                            <ul>
                                <li>Все заказы отображаются в разделе "Заказы"</li>
                                <li>Используйте фильтры для сортировки по статусам</li>
                                <li>Поиск по ID, имени клиента или телефону</li>
                            </ul>
                            <p><strong>Изменение статусов:</strong> Нажмите на кнопку редактирования статуса заказа для его обновления</p>
                        </div>

                        <div class="help-item">
                            <h3>🏷️ Система промокодов</h3>
                            <p><strong>Создание промокодов:</strong></p>
                            <ul>
                                <li>Доступно только для владельцев</li>
                                <li>Настройте тип скидки (процентная или фиксированная)</li>
                                <li>Установите лимит использований и срок действия</li>
                            </ul>
                            <p><strong>Применение промокодов:</strong> Клиенты могут вводить промокоды при оформлении заказа</p>
                        </div>

                        <div class="help-item">
                            <h3>⚙️ Настройки магазина</h3>
                            <p><strong>Основные настройки:</strong></p>
                            <ul>
                                <li>Название магазина и подзаголовок</li>
                                <li>Контактные данные и адрес</li>
                                <li>Стоимость доставки и условия бесплатной доставки</li>
                                <li>Выбор темы оформления из доступных вариантов</li>
                                <li>Выбор узора для шапки магазина</li>
                                <li>Включение/выключение снегопада, дождя, конфетти и ночного режима в каталоге</li>
                            </ul>
                        </div>

                        <div class="help-item">
                            <h3>👥 Управление администраторами</h3>
                            <p><strong>Добавление администраторов:</strong></p>
                            <ul>
                                <li>Только владельцы могут добавлять новых администраторов</li>
                                <li>Укажите Telegram ID и имя администратора</li>
                                <li>Выберите роль: администратор или владелец</li>
                            </ul>
                        </div>

                        <div class="help-item">
                            <h3>📊 Статистика и аналитика</h3>
                            <p><strong>Основные метрики:</strong></p>
                            <ul>
                                <li>Общее количество заказов и завершённых заказов</li>
                                <li>Реальная и потенциальная выручка</li>
                                <li>Количество активных товаров и промокодов</li>
                            </ul>
                        </div>

                        <div class="help-item">
                            <h3>⚠️ Опасные действия</h3>
                            <p><strong>Доступно только для владельцев:</strong></p>
                            <ul>
                                <li>Удаление всех заказов</li>
                                <li>Сброс статистики</li>
                                <li>Удаление всех промокодов</li>
                                <li>Удаление всех товаров</li>
                                <li>Очистка базы клиентов</li>
                            </ul>
                            <p>Для выполнения этих операций требуется ввод специальных кодов подтверждения.</p>
                        </div>
                    </div>
                </div>

                <div class="admin-tab-content active" id="exportTab"><div class="product-form"><div class="form-title"><i class="fas fa-file-excel"></i> Экспорт данных</div><div class="form-group"><p style="color:var(--text-light);margin-bottom:20px">Экспортирует все заказы в файл Excel. Отчет будет отправлен вам в Telegram.</p></div><button class="checkout-btn" onclick="exportToExcel()" id="exportBtn"><i class="fas fa-file-excel"></i> Экспортировать данные в Excel</button><div id="exportStatus" style="margin-top:15px;font-size:13px"></div></div></div>
                
                <div class="admin-tab-content" id="dangerousTab"><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Удаление всех заказов</div><div class="dangerous-description">Это действие полностью удалит все заказы из системы. Восстановление данных будет невозможно.</div><input type="text" class="dangerous-input" id="reset_ordersCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('reset_orders')"><i class="fas fa-trash"></i> Удалить все заказы</button></div><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Сброс статистики</div><div class="dangerous-description">Обнулит всю статистику выручки и прибыли. Заказы останутся, но их финансовые показатели будут сброшены.</div><input type="text" class="dangerous-input" id="reset_statsCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('reset_stats')"><i class="fas fa-chart-line"></i> Сбросить статистику</button></div><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Удаление всех промокодов</div><div class="dangerous-description">Полностью удалит все промокоды из системы. Действие необратимо.</div><input type="text" class="dangerous-input" id="delete_promocodesCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('delete_promocodes')"><i class="fas fa-tags"></i> Удалить все промокоды</button></div><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Удаление всех товаров</div><div class="dangerous-description">Полностью удалит все товары из каталога. Действие необратимо.</div><input type="text" class="dangerous-input" id="delete_productsCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('delete_products')"><i class="fas fa-boxes"></i> Удалить все товары</button></div><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Очистка базы клиентов</div><div class="dangerous-description">Удалит всех клиентов из системы. Статистика заказов сохранится.</div><input type="text" class="dangerous-input" id="clear_customersCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('clear_customers')"><i class="fas fa-users"></i> Очистить базу клиентов</button></div><div class="dangerous-section"><div class="dangerous-title"><i class="fas fa-exclamation-triangle"></i>Полный сброс магазина</div><div class="dangerous-description">Полностью очистит всю базу данных магазина. Все данные будут удалены без возможности восстановления.</div><input type="text" class="dangerous-input" id="reset_shopCode" placeholder="Введите код подтверждения"><button class="dangerous-btn" onclick="dangerousAction('reset_shop')"><i class="fas fa-bomb"></i> Полный сброс магазина</button></div></div>
            </div>
        </div>

        <div class="help-view" id="helpView">
            <div class="help-header">
                <div class="help-title">❓ Помощь и инструкции</div>
                <button class="help-back" onclick="switchToCustomerView()">
                    <i class="fas fa-arrow-left"></i> Назад в магазин
                </button>
            </div>

            <div class="help-tabs">
                <div class="help-tab active" data-help="ordering">🛍️ Как заказать</div>
                <div class="help-tab" data-help="delivery">🚚 Доставка</div>
                <div class="help-tab" data-help="payment">💳 Оплата</div>
                <div class="help-tab" data-help="contacts">📞 Контакты</div>
            </div>

            <div class="help-content">
                <div class="help-section active" id="orderingHelp">
                    <div class="help-item">
                        <h3>Как сделать заказ</h3>
                        <p>Процесс оформления заказа прост и интуитивно понятен:</p>
                        <ul>
                            <li>Выберите понравившиеся товары из каталога</li>
                            <li>Добавьте их в корзину, нажав кнопку "В корзину"</li>
                            <li>Перейдите в корзину, нажав на плавающую кнопку в правом нижнем углу</li>
                            <li>Выберите способ получения: доставка или самовывоз</li>
                            <li>Заполните контактные данные и подтвердите заказ</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <h3>Корзина товаров</h3>
                        <p>В корзине вы можете:</p>
                        <ul>
                            <li>Просматривать выбранные товары</li>
                            <li>Изменять количество каждого товара</li>
                            <li>Удалять ненужные позиции</li>
                            <li>Видеть итоговую сумму заказа</li>
                            <li>Применять промокоды для получения скидки</li>
                        </ul>
                    </div>
                </div>

                <div class="help-section" id="deliveryHelp">
                    <div class="help-item">
                        <h3>Условия доставки</h3>
                        <p>Мы предлагаем два способа получения заказа:</p>
                        <ul>
                            <li><strong>Доставка курьером</strong> - привезем заказ по указанному адресу в Ярославле</li>
                            <li><strong>Самовывоз</strong> - заберете заказ самостоятельно из нашего магазина</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <h3>Стоимость доставки</h3>
                        <p>Доставка стоит 200 рублей. При заказе от 3000 рублей - доставка бесплатная.</p>
                        <p>Время доставки: ежедневно с 9:00 до 20:00</p>
                    </div>
                </div>

                <div class="help-section" id="paymentHelp">
                    <div class="help-item">
                        <h3>Способы оплаты</h3>
                        <p>Мы принимаем следующие способы оплаты:</p>
                        <ul>
                            <li>Наличными курьеру при получении</li>
                            <li>Банковской картой через терминал</li>
                            <li>Онлайн-переводом по предоплате</li>
                        </ul>
                    </div>
                    
                    <div class="help-item">
                        <h3>Подтверждение заказа</h3>
                        <p>После оформления заказа наш менеджер свяжется с вами для подтверждения деталей и уточнения способа оплаты.</p>
                    </div>
                </div>

                <div class="help-section" id="contactsHelp">
                    <div class="help-item">
                        <h3>Наши контакты</h3>
                        <p><strong>Телефон:</strong> +7 (999) 785-86-35</p>
                        <p><strong>Адрес:</strong> Ярославль, ул. Угличская, 4к1, Ярославль</p>
                        <p><strong>Режим работы:</strong> Ежедневно с 9:00 до 20:00</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="floating-buttons">
        <button class="cart-button" id="cartButton" onclick="showCartModal()">
            <i class="fas fa-shopping-bag"></i>
            <span id="cartTotalAmount">0 ₽</span>
            <span class="cart-count" id="cartCount">0</span>
        </button>
        <button class="admin-button" onclick="switchToAdminView()" title="Панель управления" id="adminButton">
            <i class="fas fa-cog"></i>
        </button>
        <button class="help-button" onclick="showHelp()" title="Помощь" id="helpButton">
            <i class="fas fa-question"></i>
        </button>
    </div>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-shopping-cart"></i> Корзина товаров</div>
                <button class="close-modal" id="closeCart">×</button>
            </div>
            <div class="cart-items" id="cartItems"></div>
            <div class="cart-total">
                <span>Сумма заказа:</span>
                <span id="modalTotal">0 ₽</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="showOrderModal()">
                <i class="fas fa-receipt"></i> Перейти к оформлению
            </button>
        </div>
    </div>

    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-file-invoice"></i> Подтверждение заказа</div>
                <button class="close-modal" id="closeOrder">×</button>
            </div>
            
            <div id="orderForm">
                <div class="order-summary">
                    <h3 style="margin-bottom:12px">Детали заказа</h3>
                    <div id="orderSummaryContent"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Промокод (если есть)</label>
                    <div style="display:flex;gap:8px">
                        <input type="text" class="form-input" id="promoCodeInput" placeholder="Введите промокод">
                        <button class="btn btn-primary" onclick="validatePromocode()" style="white-space:nowrap">✓ ОК</button>
                    </div>
                    <div id="promoCodeMessage" style="font-size:12px;margin-top:4px"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Контактный телефон *</label>
                    <input type="tel" class="form-input phone-input" id="phoneInput" placeholder="+7 (XXX) XXX-XX-XX" required value="+7">
                    <div class="settings-hint">Укажите номер для связи с вами</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Способ получения</label>
                    <div class="delivery-option selected" data-type="pickup" onclick="selectDeliveryOption('pickup')">
                        <div class="delivery-option-header">
                            <i class="fas fa-store"></i>
                            <div class="delivery-option-title">Самовывоз из магазина</div>
                            <div class="delivery-price">Бесплатно</div>
                        </div>
                        <div class="delivery-option-description">Заберите заказ самостоятельно в удобное время</div>
                    </div>
                    <div class="delivery-option" data-type="delivery" onclick="selectDeliveryOption('delivery')">
                        <div class="delivery-option-header">
                            <i class="fas fa-truck"></i>
                            <div class="delivery-option-title">Доставка курьером</div>
                            <div class="delivery-price" id="deliveryPriceText">200 ₽</div>
                        </div>
                        <div class="delivery-option-description">Привезем заказ по указанному адресу в Ярославле</div>
                    </div>
                </div>

                <div class="form-group" id="addressField" style="display:none">
                    <label class="form-label">Адрес доставки *</label>
                    <textarea class="form-input" id="deliveryAddress" placeholder="Укажите полный адрес доставки: улица, дом, квартира..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Комментарий к заказу</label>
                    <textarea class="form-input" id="orderComment" placeholder="Особые пожелания, время доставки, дополнительные указания..." rows="3"></textarea>
                </div>
                
                <div class="form-actions" style="margin-top:20px">
                    <button class="checkout-btn" id="confirmOrderBtn" onclick="submitOrder()" disabled>
                        <i class="fas fa-paper-plane"></i> Оформить заказ
                    </button>
                </div>
            </div>

            <div id="orderSuccess" style="display:none">
                <div class="success-state">
                    <div class="success-icon">🎉</div>
                    <div class="success-title">Заказ успешно оформлен!</div>
                    <div class="success-message">
                        Ваш заказ принят в обработку. Мы свяжемся с вами в ближайшее время для уточнения деталей доставки и подтверждения заказа.
                    </div>
                    <button class="checkout-btn" onclick="closeOrderSuccess()">
                        <i class="fas fa-shopping-bag"></i> Продолжить покупки
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="editProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-edit"></i> Редактировать товар</div>
                <button class="close-modal" id="closeEditProduct">×</button>
            </div>
            <div id="editProductForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label class="form-label">Название товара</label>
                    <input type="text" class="form-input" id="editProductName">
                </div>
                <div class="form-group">
                    <label class="form-label">Цена</label>
                    <input type="number" class="form-input" id="editProductPrice">
                </div>
                <div class="form-group">
                    <label class="form-label">Изображение</label>
                    <input type="text" class="form-input" id="editProductImage">
                </div>
                <div class="form-group">
                    <label class="form-label">Категория</label>
                    <div class="dropdown">
                        <div class="dropdown-toggle" id="editCategoryDropdownToggle">
                            <span>Выберите категорию</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="editCategoryDropdown">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Описание</label>
                    <textarea class="form-input" id="editProductDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Интересный факт</label>
                    <textarea class="form-input" id="editProductFact" rows="2"></textarea>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="editProductAvailable" checked>
                    <label class="checkbox-label">Товар доступен для заказа</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="editProductFeatured">
                    <label class="checkbox-label">Хит товар (бейдж "Хит")</label>
                </div>
                <button class="checkout-btn" onclick="updateProduct()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-edit"></i> Редактировать категорию</div>
                <button class="close-modal" id="closeEditCategory">×</button>
            </div>
            <div id="editCategoryForm">
                <input type="hidden" id="editCategoryId">
                <div class="form-group">
                    <label class="form-label">Название категории</label>
                    <input type="text" class="form-input" id="editCategoryName">
                </div>
                <div class="form-group">
                    <label class="form-label">Slug (англ.)</label>
                    <input type="text" class="form-input" id="editCategorySlug">
                </div>
                <div class="form-group">
                    <label class="form-label">Иконка</label>
                    <div class="icon-scroll-container">
                        <div class="icon-grid" id="editIconGrid">
                        </div>
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="editCategoryActive" checked>
                    <label class="checkbox-label">Категория активна</label>
                </div>
                <button class="checkout-btn" onclick="updateCategory()">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
            </div>
        </div>
    </div>

    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="confirmation-title">Подтверждение удаления</div>
            <div class="confirmation-message" id="confirmationMessage">Вы уверены, что хотите удалить этот элемент?</div>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" onclick="closeConfirmationModal()">Отмена</button>
                <button class="confirmation-btn confirm" id="confirmDeleteBtn">Удалить</button>
            </div>
        </div>
    </div>

    <div class="status-modal" id="statusModal">
        <div class="status-modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-edit"></i> Изменить статус заказа</div>
                <button class="close-modal" onclick="closeStatusModal()">×</button>
            </div>
            <div class="form-group">
                <div class="status-option" data-status="1" onclick="selectStatus(1)">
                    <strong>Новый</strong> - заказ только что создан
                </div>
                <div class="status-option" data-status="2" onclick="selectStatus(2)">
                    <strong>Подтвержден</strong> - заказ подтвержден менеджером
                </div>
                <div class="status-option" data-status="3" onclick="selectStatus(3)">
                    <strong>Собирается</strong> - заказ формируется к отправке
                </div>
                <div class="status-option" data-status="4" onclick="selectStatus(4)">
                    <strong>В пути</strong> - заказ доставляется клиенту
                </div>
                <div class="status-option" data-status="5" onclick="selectStatus(5)">
                    <strong>Доставлен</strong> - заказ успешно доставлен
                </div>
                <div class="status-option" data-status="6" onclick="selectStatus(6)">
                    <strong>Отменен</strong> - заказ отменен
                </div>
            </div>
            <button class="checkout-btn" onclick="applyStatusChange()" id="applyStatusBtn" disabled>
                <i class="fas fa-check"></i> Применить статус
            </button>
        </div>
    </div>
    <div class="dangerous-modal" id="dangerousActionModal">
    <div class="dangerous-modal-content">
        <div class="dangerous-modal-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="dangerous-modal-title" id="dangerousModalTitle">Подтверждение действия</div>
        <div class="dangerous-modal-message" id="dangerousModalMessage">Вы уверены, что хотите выполнить это действие? Это действие нельзя отменить!</div>
        <div class="dangerous-modal-actions">
            <button class="dangerous-modal-btn cancel" onclick="closeDangerousModal()">Отмена</button>
            <button class="dangerous-modal-btn confirm" id="confirmDangerousAction">Подтвердить</button>
        </div>
    </div>
</div>

    <script>
        let tg=window.Telegram.WebApp;tg.expand();tg.ready();let cart=[];let currentCategory='all';let products=[];let isAdmin=false;let currentUserRole='';let currentDangerousAction=null;let currentConfirmationCode=null;let adminData={products:[],orders:[],admins:[],stats:{},settings:{},themes:[],promocodes:[],categories:[]};let deliveryOption='pickup';let deliveryPrice=200;let freeDeliveryMin=3000;let currentOrdersPage=1;let ordersPerPage=10;let appliedPromocode=null;let activePattern='dots';let currentOrderId=null;let selectedStatus=null;let selectedCategory=null;let selectedIcon=null;let selectedDiscountType='percentage';let selectedRole='admin';let snowEnabled=false;let rainEnabled=false;let confettiEnabled=false;let nightEnabled=false;let snowflakes=[];let raindrops=[];let confettiPieces=[];let lightSpots=[];let currentDeleteCallback=null;let currentDeleteId=null;let currentDeleteType=null;let currentProductFilter='all';let currentProductSearch='';let aiChatHistory = [];
        
        const toggleAI = (s) => document.getElementById('ai-modal').style.display = s ? 'flex' : 'none';

        const formatAIResponse = (t) => t.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>');

        async function sendAIMessage(){const i=document.getElementById('ai-user-input'),c=document.getElementById('ai-chat-container'),m=i.value.trim();if(!m)return;i.value='';c.innerHTML+=`<div class="ai-msg user"><b>Вы:</b> ${m}</div>`;c.scrollTop=c.scrollHeight;const l=document.createElement('div');l.className='ai-msg bot';l.innerHTML='<i>Думаю...</i>';c.appendChild(l);try{const r=await fetch('/api/AI',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:m,context:'Магазин цветов АртФлора'})});const d=await r.json();l.innerHTML=`<b>AI:</b> ${formatAIResponse(d.response||d.error)}`;}catch(e){l.innerHTML=`<b>Ошибка:</b> Не удалось связаться с сервером. Детали: ${e.message}`;}c.scrollTop=c.scrollHeight;}
        
        async function exportToExcel(){if(!isAdmin)return showToast('Требуются права администратора','error');const e=document.getElementById('exportBtn'),t=document.getElementById('exportStatus'),n=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Формируем отчет...',t.textContent='',t.style.color='var(--text-light)';try{console.log('📤 Отправка GET запроса на экспорт...');const response=await fetch('/api/order/export',{method:'GET',headers:{'Telegram-Id':tg.initDataUnsafe.user?.id||'','Is-Admin':'true'}});console.log('📥 Ответ получен:',response.status,response.statusText);if(!response.ok)throw new Error(`HTTP ошибка: ${response.status}`);const data=await response.json();console.log('📊 Данные ответа:',data);data.success?(t.textContent='✅ Отчет успешно сформирован! Файл отправлен в ваш Telegram.',t.style.color='#10B981',showToast('Excel-файл отправлен в Telegram','success')):(t.textContent='❌ Ошибка: '+(data.error||'Неизвестная ошибка'),t.style.color='#EF4444',showToast('Ошибка при экспорте','error'))}catch(error){console.error('💥 Ошибка экспорта:',error);t.textContent='❌ Ошибка соединения с сервером: '+error.message;t.style.color='#EF4444';showToast('Ошибка соединения','error')}finally{e.disabled=!1;e.innerHTML=n}}
        
        function validateOrderForm(){const e=document.getElementById('phoneInput'),t=document.getElementById('deliveryAddress'),n=document.getElementById('confirmOrderBtn');if(!n)return;const i=e.value.trim(),o=t.value.trim(),s=validatePhone(i),a=deliveryOption==='delivery'?o.length>0:!0,r=cart.length>0;n.disabled=!(s&&a&&r);n.style.background=n.disabled?'var(--secondary)':'linear-gradient(135deg,#10b981 0%,#059669 100%)';}
        
        function showToast(message,type='success'){const toast=document.getElementById('toast');const toastMessage=document.getElementById('toastMessage');const toastIcon=document.getElementById('toastIcon');toastMessage.textContent=message;toast.className='toast';toast.classList.add(type);if(type==='success'){toastIcon.className='fas fa-check-circle'}else if(type==='error'){toastIcon.className='fas fa-times-circle'}else{toastIcon.className='fas fa-info-circle'}toast.classList.add('show');setTimeout(()=>{toast.classList.remove('show')},2000)}
        
        async function loadProducts(){try{const response=await fetch('/api/products');if(!response.ok)throw new Error('Network error');products=await response.json();renderProducts()}catch(error){console.error('Error loading products:',error);showToast('Ошибка загрузки каталога','error');renderProducts([])}}

        async function loadCategories(){try{const response=await fetch('/api/admin/categories');if(response.ok){const categories=await response.json();adminData.categories=categories;renderCategories(categories);renderCategoryDropdowns(categories);renderCategoriesAdmin(categories)}else{await createDefaultCategories()}}catch(error){console.error('Error loading categories:',error);await createDefaultCategories()}}

        async function createDefaultCategories(){const defaultCategories=[{name:'Розы',slug:'roses',icon:'fas fa-heart'},{name:'Тюльпаны',slug:'tulips',icon:'fas fa-sun'},{name:'Орхидеи',slug:'orchids',icon:'fas fa-spa'},{name:'Премиум букеты',slug:'premium',icon:'fas fa-crown'}];for(const category of defaultCategories){try{await fetch('/api/admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(category)})}catch(e){console.error('Error creating category:',e)}}await loadCategories()}

        function renderCategories(categories){const container=document.getElementById('categoriesContainer');if(!categories||categories.length===0){container.innerHTML='<div class="loading"><div>Категории не найдены</div></div>';return}container.innerHTML='<button class="category-btn active" onclick="filterByCategory(\'all\')"><i class="fas fa-star"></i>Все товары</button>';categories.forEach(category=>{if(category.is_active){const btn=document.createElement('button');btn.className='category-btn';btn.onclick=()=>filterByCategory(category.slug);btn.innerHTML=`<i class="${category.icon}"></i>${category.name}`;container.appendChild(btn)}})}

        function filterByCategory(category){currentCategory=category;document.querySelectorAll('.category-btn').forEach(btn=>btn.classList.remove('active'));event.target.classList.add('active');renderProducts(category);tg.HapticFeedback.selectionChanged()}

        function renderProducts(category='all'){const grid=document.getElementById('productsGrid');if(products.length===0){grid.innerHTML='<div class="loading"><div>Товары временно недоступны</div></div>';return}grid.innerHTML='';const filteredProducts=category==='all'?products:products.filter(product=>product.category===category&&product.is_available);if(filteredProducts.length===0){grid.innerHTML='<div class="loading"><div>В этой категории пока нет товаров</div></div>';return}filteredProducts.forEach(product=>{const productCard=document.createElement('div');productCard.className='product-card fact-light';productCard.innerHTML=`<div class="product-image"><img src="${product.image_url}" alt="${product.name}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yMDAgMTUwQzIyNSAyMDAgMjUwIDE1MCAyMDAgMTAwQzE1MCAxNTAgMTc1IDIwMCAyMDAgMTUwWiIgZmlsbD0iI0U1RTVFNSIvPgo8L3N2Zz4K'">${product.is_featured?'<div class="product-badge">Хит</div>':''}</div><div class="product-content"><div class="product-title">${product.name}</div><div class="product-description">${product.description}</div>${product.fact?`<div class="product-fact"><i class="fas fa-lightbulb fact-icon"></i><span class="product-fact-text">${product.fact}</span></div>`:''}<div class="product-footer"><div class="product-price">${product.price.toLocaleString()} ₽</div><button class="add-to-cart" data-id="${product.id}"><i class="fas fa-plus"></i>В корзину</button></div></div>`;grid.appendChild(productCard)});document.querySelectorAll('.add-to-cart').forEach(button=>{button.addEventListener('click',(e)=>{const productId=parseInt(e.target.closest('.add-to-cart').dataset.id);addToCart(productId)})});setupNightEffect()}

        function setupNightEffect(){
            if(!nightEnabled) return;
            document.querySelectorAll('.fact-light').forEach(element=>{
                if(element.dataset.nightSetup==='1') return;
                element.dataset.nightSetup='1';
                
                element.addEventListener('touchstart',function(e){
                    const touch=e.touches[0];
                    const rect=this.getBoundingClientRect();
                    const x=touch.clientX-rect.left;
                    const y=touch.clientY-rect.top;
                    this.style.setProperty('--mouse-x',x+'px');
                    this.style.setProperty('--mouse-y',y+'px');
                },{passive:true});
                
                element.addEventListener('mousemove',function(e){
                    const rect=this.getBoundingClientRect();
                    const x=e.clientX-rect.left;
                    const y=e.clientY-rect.top;
                    this.style.setProperty('--mouse-x',x+'px');
                    this.style.setProperty('--mouse-y',y+'px');
                });
                
                // Лампочка "Интересный факт": включается/выключается, и только в включенном состоянии дает желтый свет.
                const fact = element.querySelector('.product-fact');
                if(fact && !fact.dataset.lampSetup){
                    fact.dataset.lampSetup='1';
                    fact.addEventListener('click',()=>{
                        if(fact.dataset._touched==='1') return;
                        if(!nightEnabled) return;
                        fact.classList.toggle('lamp-on');
                        try{ tg?.HapticFeedback?.impactOccurred?.('soft'); }catch(e){}
                    });
                    fact.addEventListener('touchstart',()=>{
                        // предотвращаем двойной toggle на некоторых устройствах (touchstart+click)
                        fact.dataset._touched='1';
                        setTimeout(()=>{ delete fact.dataset._touched; },350);
                    },{passive:true});
                }
            });
        }

        function addToCart(productId){const product=products.find(p=>p.id===productId);if(product){const existingItem=cart.find(item=>item.id===productId);if(existingItem){existingItem.quantity+=1}else{cart.push({...product,quantity:1})}updateCartDisplay();tg.HapticFeedback.impactOccurred('soft');showToast('Товар добавлен в корзину','success')}}

        function updateCartDisplay(){const cartButton=document.getElementById('cartButton');const cartCount=document.getElementById('cartCount');const cartTotalAmount=document.getElementById('cartTotalAmount');const totalItems=cart.reduce((sum,item)=>sum+item.quantity,0);const totalAmount=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);cartCount.textContent=totalItems;cartTotalAmount.textContent=totalAmount.toLocaleString()+' ₽';if(totalItems>0){cartButton.style.display='flex'}else{cartButton.style.display='none'}renderCartItems();updateOrderSummary()}

        function renderCartItems(){const cartItems=document.getElementById('cartItems');const modalTotal=document.getElementById('modalTotal');const totalAmount=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);modalTotal.textContent=totalAmount.toLocaleString()+' ₽';if(cart.length===0){cartItems.innerHTML='<div class="empty-cart"><i class="fas fa-shopping-bag"></i><div>Корзина пуста</div></div>';return}cartItems.innerHTML='';cart.forEach((item,index)=>{const cartItem=document.createElement('div');cartItem.className='cart-item';cartItem.innerHTML=`<div class="item-info"><div class="item-name">${item.name}</div><div class="item-price">${item.price.toLocaleString()} ₽</div></div><div class="item-actions"><div class="quantity-controls"><button class="quantity-btn" data-index="${index}" data-action="decrease">-</button><span class="quantity">${item.quantity}</span><button class="quantity-btn" data-index="${index}" data-action="increase">+</button></div><button class="remove-item" data-index="${index}"><i class="fas fa-trash"></i></button></div>`;cartItems.appendChild(cartItem)});document.querySelectorAll('.quantity-btn').forEach(button=>{button.addEventListener('click',(e)=>{const index=parseInt(e.target.closest('.quantity-btn').dataset.index);const action=e.target.closest('.quantity-btn').dataset.action;updateQuantity(index,action)})});document.querySelectorAll('.remove-item').forEach(button=>{button.addEventListener('click',(e)=>{const index=parseInt(e.target.closest('.remove-item').dataset.index);removeFromCart(index)})})}

        function updateQuantity(index,action){if(action==='increase'){cart[index].quantity+=1}else if(action==='decrease'){if(cart[index].quantity>1){cart[index].quantity-=1}else{removeFromCart(index);return}}updateCartDisplay();tg.HapticFeedback.selectionChanged()}

        function removeFromCart(index){const removedItem=cart[index];cart.splice(index,1);updateCartDisplay();tg.HapticFeedback.impactOccurred('light');showToast('Товар удален из корзины','error')}

        function showCartModal(){document.getElementById('cartModal').style.display='flex'}

        function selectDeliveryOption(e){deliveryOption=e;document.querySelectorAll('.delivery-option').forEach(t=>{t.classList.remove('selected')});document.querySelector(`.delivery-option[data-type="${e}"]`).classList.add('selected');const t=document.getElementById('addressField');e==='delivery'?(t.style.display='block'):(t.style.display='none');updateOrderSummary();validateOrderForm();}
        
        function updateOrderSummary(){const cartTotal=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);let finalTotal=cartTotal;let deliveryCost=0;let deliveryText='';if(deliveryOption==='delivery'){deliveryCost=cartTotal>=freeDeliveryMin?0:deliveryPrice;finalTotal=cartTotal+deliveryCost;deliveryText=deliveryCost>0?`${deliveryCost} ₽ (бесплатно от ${freeDeliveryMin} ₽)`:'Бесплатно'}else{deliveryText='Бесплатно'}if(appliedPromocode){finalTotal-=appliedPromocode.discount_amount}const summaryContent=document.getElementById('orderSummaryContent');if(summaryContent){summaryContent.innerHTML=cart.map(item=>`<div class="summary-row"><span>${item.name} × ${item.quantity}</span><span>${(item.price*item.quantity).toLocaleString()} ₽</span></div>`).join('')+`<div class="summary-row"><span>Доставка</span><span>${deliveryText}</span></div>`+(appliedPromocode?`<div class="summary-row"><span>Скидка по промокоду</span><span>-${appliedPromocode.discount_amount} ₽</span></div>`:'')+`<div class="summary-row total"><span>Итого к оплате</span><span>${finalTotal.toLocaleString()} ₽</span></div>`}}

        function validatePhone(phone){const phoneRegex=/^(\+7|8)[\s\-]?\(?[489][0-9]{2}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/;return phoneRegex.test(phone.replace(/\s/g,''))}

        async function validatePromocode(){const code=document.getElementById('promoCodeInput').value;const cartTotal=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);if(!code){showToast('Введите промокод','error');return}try{const response=await fetch('/api/promocodes',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'validate',code:code,order_amount:cartTotal})});const result=await response.json();if(result.valid){appliedPromocode=result;document.getElementById('promoCodeMessage').textContent=`✅ Промокод применён! Скидка: ${result.discount_amount}₽`;document.getElementById('promoCodeMessage').style.color='green';updateOrderSummary();showToast('Промокод успешно применён','success')}else{document.getElementById('promoCodeMessage').textContent=`❌ ${result.error}`;document.getElementById('promoCodeMessage').style.color='red';appliedPromocode=null;updateOrderSummary()}}catch(error){console.error('Error validating promocode:',error);showToast('Ошибка проверки промокода','error')}}

        function showOrderModal(){if(cart.length===0){tg.showAlert('Корзина пуста.');return;}document.getElementById('cartModal').style.display='none';document.getElementById('orderModal').style.display='flex';selectDeliveryOption('pickup');updateOrderSummary();validateOrderForm();}
        
        function submitOrder(){const phone=document.getElementById('phoneInput').value;const comment=document.getElementById('orderComment').value;const deliveryAddress=deliveryOption==='delivery'?document.getElementById('deliveryAddress').value:'';if(deliveryOption==='delivery'&&!deliveryAddress.trim()){tg.showAlert('Пожалуйста, укажите адрес доставки.');return}if(!validatePhone(phone)){tg.showAlert('Пожалуйста, укажите корректный номер телефона.');return}const cartTotal=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);let finalTotal=cartTotal;if(deliveryOption==='delivery'){finalTotal+=cartTotal>=freeDeliveryMin?0:deliveryPrice}if(appliedPromocode){finalTotal-=appliedPromocode.discount_amount}const orderData={user:{id:tg.initDataUnsafe.user?.id||'Неизвестно',first_name:tg.initDataUnsafe.user?.first_name||'Неизвестно',username:tg.initDataUnsafe.user?.username||'Неизвестно'},phone:phone,comment:comment,delivery_option:deliveryOption,delivery_address:deliveryAddress,items:cart.map(item=>({id:item.id,name:item.name,price:item.price,quantity:item.quantity,total:item.price*item.quantity})),total:finalTotal,promocode_id:appliedPromocode?.promocode_id||null,discount_amount:appliedPromocode?.discount_amount||0,time:new Date().toLocaleString('ru-RU')};document.getElementById('confirmOrderBtn').disabled=true;document.getElementById('confirmOrderBtn').innerHTML='<i class="fas fa-spinner fa-spin"></i> Отправляем...';sendOrderToAdmin(orderData).then(success=>{if(success){showOrderSuccess()}}).catch(error=>{document.getElementById('confirmOrderBtn').disabled=false;document.getElementById('confirmOrderBtn').innerHTML='<i class="fas fa-paper-plane"></i> Оформить заказ'})}

        function sendOrderToAdmin(orderData){return fetch('/api/order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(orderData)}).then(response=>response.json()).then(data=>{if(data.success){return true}else{tg.showAlert('Ошибка при оформлении заказа.');return false}}).catch(error=>{console.error('Error:',error);tg.showAlert('Ошибка при оформлении заказа.');return false})}

        function showOrderSuccess(){document.getElementById('orderForm').style.display='none';document.getElementById('orderSuccess').style.display='block'}

        function closeOrderSuccess(){document.getElementById('orderModal').style.display='none';cart=[];appliedPromocode=null;updateCartDisplay();document.getElementById('orderForm').style.display='block';document.getElementById('orderSuccess').style.display='none';document.getElementById('phoneInput').value='+7';document.getElementById('orderComment').value='';document.getElementById('deliveryAddress').value='';document.getElementById('promoCodeInput').value='';document.getElementById('promoCodeMessage').textContent='';selectDeliveryOption('pickup');validateOrderForm();}
        
        function setupEventListeners(){document.querySelectorAll('.filter-btn').forEach(btn=>{btn.addEventListener('click',function(){document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));this.classList.add('active');if(this.closest('#productsTab')){filterProducts()}else{filterOrders()}})});document.getElementById('confirmDangerousAction').addEventListener('click',executeDangerousAction);const map={'closeCart':'cartModal','closeOrder':'orderModal','closeEditProduct':'editProductModal','closeEditCategory':'editCategoryModal'};Object.keys(map).forEach(id=>{const el=document.getElementById(id);if(el)el.addEventListener('click',()=>document.getElementById(map[id]).style.display='none')})}
        
        function setupConfirmationModal(){document.getElementById('confirmDeleteBtn').addEventListener('click',function(){if(currentDeleteCallback){currentDeleteCallback(currentDeleteId,currentDeleteType)}closeConfirmationModal()})}

        function showConfirmationModal(message,type,id,callback){document.getElementById('confirmationMessage').textContent=message;currentDeleteCallback=callback;currentDeleteId=id;currentDeleteType=type;document.getElementById('confirmationModal').style.display='flex'}

        function closeConfirmationModal(){document.getElementById('confirmationModal').style.display='none';currentDeleteCallback=null;currentDeleteId=null;currentDeleteType=null}
        
        function initDropdowns(){document.addEventListener('click',function(e){if(e.target.closest('.dropdown-toggle')){e.stopPropagation();var t=e.target.closest('.dropdown-toggle');var n=t.nextElementSibling;document.querySelectorAll('.dropdown-menu').forEach(function(e){e!==n&&e.classList.contains('show')&&e.classList.remove('show')});n.classList.toggle('show')}else if(e.target.closest('.dropdown-item')){e.stopPropagation();var i=e.target.closest('.dropdown-item');var r=i.closest('.dropdown');var o=r.querySelector('.dropdown-toggle');var a=i.dataset.value;var c=i.textContent;o.querySelector('span').textContent=c;o.dataset.selectedValue=a;if(r.id==='categoryDropdown'||r.id==='editCategoryDropdown'){selectedCategory=a}else if(r.id==='discountTypeDropdown'){selectedDiscountType=a;document.getElementById('promoDiscountSuffix').textContent=a==='percentage'?'%':'₽'}else if(r.id==='roleDropdown'){selectedRole=a}r.querySelector('.dropdown-menu').classList.remove('show')}else{document.querySelectorAll('.dropdown-menu').forEach(function(e){e.classList.remove('show')})}})}
        
        function initIconSelection(){document.querySelectorAll('.icon-option').forEach(option=>{option.addEventListener('click',function(){document.querySelectorAll('.icon-option').forEach(opt=>opt.classList.remove('selected'));this.classList.add('selected');selectedIcon=this.dataset.icon})})}

        function renderCategoryDropdowns(e){var t=['categoryDropdown','editCategoryDropdown'];t.forEach(function(t){var n=document.getElementById(t);if(n){n.innerHTML='';var i=document.createElement('div');i.className='dropdown-item';i.dataset.value='';i.innerHTML='<i class="fas fa-times"></i> Без категории';n.appendChild(i);e.forEach(function(e){var t=document.createElement('div');t.className='dropdown-item';t.dataset.value=e.slug;t.innerHTML='<i class="'+e.icon+'"></i> '+e.name;n.appendChild(t)})}})}
        
        async function checkAdminAccess(){try{const e=String(tg.initDataUnsafe.user?.id||"");console.log("Checking admin access for:",e);const t=await fetch("/api/admin",{headers:{"Telegram-Id":e}});const n=await t.json();console.log("Admin check response:",n);isAdmin=n.is_admin===true&&n.is_active!==false;currentUserRole=n.role||"";if(isAdmin){document.getElementById("adminButton").style.display="flex";updateOwnerElements();console.log("Admin access granted, role:",currentUserRole,"isAdmin:",isAdmin)}else{console.log("Admin access denied")}}catch(e){console.error("Ошибка проверки админ-доступа:",e)}}
        
        function updateOwnerElements(){console.log("Updating owner elements, current role:",currentUserRole);var e=document.getElementById("dangerousTabButton"),t=document.getElementById("promoFormContainer"),n=document.getElementById("adminFormContainer"),o=document.querySelector('[data-tab="export"]');if(currentUserRole==="owner"){e&&(e.style.display="flex"),t&&(t.style.display="block"),n&&(n.style.display="block"),o&&(o.style.display="flex");console.log("Owner elements enabled")}else{e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="flex");console.log("Owner elements disabled, export tab enabled")}}
        
        function switchToCustomerView(){document.getElementById("adminPanel").style.display="none";document.getElementById("helpView").style.display="none";document.getElementById("customerView").style.display="block";document.getElementById("adminButton").style.display=isAdmin?"flex":"none";document.getElementById("helpButton").style.display="flex"}
        
        function switchToAdminView(){if(!isAdmin){showToast("Нет доступа к панели управления","error");return}document.getElementById("customerView").style.display="none";document.getElementById("adminPanel").style.display="block";document.getElementById("helpView").style.display="none";document.getElementById("adminButton").style.display="none";document.getElementById("helpButton").style.display="none";updateOwnerElements();setTimeout(function(){setupAdminTabs();loadAdminData()},100)}
        
        function showHelp(){document.getElementById("customerView").style.display="none";document.getElementById("adminPanel").style.display="none";document.getElementById("helpView").style.display="block";document.getElementById("adminButton").style.display="none";document.getElementById("helpButton").style.display="none"}
        
        function setupAdminTabs(){document.querySelectorAll('.admin-tab').forEach(e=>{e.onclick=null;e.addEventListener('click',function(){document.querySelectorAll('.admin-tab').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.admin-tab-content').forEach(e=>{e.style.display='none';e.classList.remove('active')});this.classList.add('active');const t=this.dataset.tab,n=document.getElementById(t+'Tab');if(n){n.style.display='block';n.classList.add('active');if(t==='dashboard')loadDashboard();if(t==='products')loadProductsAdmin();if(t==='orders')loadOrdersAdmin();if(t==='promocodes')loadPromocodes();if(t==='admins')loadAdmins();if(t==='settings')loadSettings();if(t==='export'){}if(t==='ai')loadAiTab();if(t==='dangerous'){}}})})}
        
        function showTab(e){document.querySelectorAll(".admin-tab").forEach(function(e){e.classList.remove("active")});document.querySelectorAll(".admin-tab-content").forEach(function(e){e.style.display="none";e.classList.remove("active")});var t=document.querySelector('[data-tab="'+e+'"]');var n=document.getElementById(e+"Tab");if(t&&n){t.classList.add("active");n.style.display="block";n.classList.add("active");if(e==="dashboard")loadDashboard();if(e==="products")loadProductsAdmin();if(e==="orders")loadOrdersAdmin();if(e==="promocodes")loadPromocodes();if(e==="admins")loadAdmins();if(e==="settings")loadSettings()}}
        
        async function loadAdminData(){await loadDashboard();await loadProductsAdmin();await loadOrdersAdmin();await loadPromocodes();await loadAdmins();await loadSettings();await loadCategories()}

        async function loadDashboard(){try{const response=await fetch('/api/admin/stats');const stats=await response.json();document.getElementById('totalOrders').textContent=stats.total_orders;document.getElementById('completedOrders').textContent=stats.completed_orders;document.getElementById('totalRevenue').textContent=stats.total_revenue.toLocaleString()+' ₽';document.getElementById('potentialRevenue').textContent=stats.potential_revenue.toLocaleString()+' ₽';document.getElementById('totalProducts').textContent=stats.total_products;document.getElementById('activePromocodes').textContent=stats.active_promocodes||0}catch(error){console.error('Error loading dashboard:',error)}}

        async function loadProductsAdmin(){try{const response=await fetch('/api/products?show_all=true');const products=await response.json();adminData.products=products;document.getElementById('productSearch').value=currentProductSearch;document.querySelectorAll('.filter-btn').forEach(btn=>btn.classList.remove('active'));document.querySelector(`.filter-btn[data-status="${currentProductFilter}"]`).classList.add('active');filterProducts();}catch(error){console.error('Error loading products admin:',error);}} 
        
        async function updateCategoriesOrder(){const categoriesOrder={};adminData.categories.forEach((category,index)=>{categoriesOrder[category.id]=index+1});try{const response=await fetch('/api/admin/categories/reorder',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({reorder:categoriesOrder})});const result=await response.json();if(result.success){showToast('Порядок категорий обновлен','success')}}catch(error){console.error('Error updating categories order:',error);showToast('Ошибка обновления порядка','error')}}
        
        function renderProductsAdmin(products){const productsList=document.getElementById('productsList');productsList.innerHTML='';if(products.length===0){productsList.innerHTML='<tr><td colspan="8" class="empty-table-message">Товары не найдены</td></tr>';return}products.forEach((product,index)=>{const row=document.createElement('tr');row.className='table-row';if(!product.is_available){row.classList.add('product-inactive')}row.setAttribute('data-id',product.id);const category=adminData.categories.find(c=>c.slug===product.category);row.innerHTML=`<td>${product.id}</td><td><img src="${product.image_url}" alt="${product.name}" class="table-product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0zMCAyMEMyNSAzMCAyMCAyMCAzMCAxMEM0MCAyMCAzNSAzMCAzMCAyMFoiIGZpbGw9IiNFNUU1RTUiLz4KPC9zdmc+'"></td><td><strong>${product.name}</strong><div style="font-size:11px;color:var(--text-light)">${product.description}</div></td><td>${product.price} ₽</td><td>${category?category.name:product.category}</td><td><span class="product-status ${product.is_available?'status-active':'status-inactive'}">${product.is_available?'Активен':'Неактивен'}</span></td><td><div class="move-buttons"><button class="move-btn" onclick="moveProductUp(${product.id})" ${index===0?'disabled':''}><i class="fas fa-chevron-up"></i></button><button class="move-btn" onclick="moveProductDown(${product.id})" ${index===products.length-1?'disabled':''}><i class="fas fa-chevron-down"></i></button></div></td><td><div class="admin-actions"><button class="btn btn-primary btn-sm" onclick="editProduct(${product.id})" title="Редактировать"><i class="fas fa-edit fa-lg"></i></button><button class="btn btn-danger btn-sm" onclick="showDeleteConfirmation('product',${product.id})" title="Удалить"><i class="fas fa-trash fa-lg"></i></button></div></td>`;productsList.appendChild(row)})}
            
        function renderCategoriesAdmin(categories){const categoriesList=document.getElementById('categoriesList');categoriesList.innerHTML='';if(categories.length===0){categoriesList.innerHTML='<tr><td colspan="7" class="empty-table-message">Категории не найдены</td></tr>';return}categories.forEach((category,index)=>{const row=document.createElement('tr');row.className='table-row';if(!category.is_active){row.classList.add('category-inactive')}row.innerHTML=`<td>${category.id}</td><td><i class="${category.icon}"></i> ${category.name}</td><td>${category.slug}</td><td><i class="${category.icon}"></i></td><td><span class="product-status ${category.is_active?'status-active':'status-inactive'}">${category.is_active?'Активна':'Неактивна'}</span></td><td><div class="move-buttons"><button class="move-btn" onclick="moveCategoryUp(${category.id})" ${index===0?'disabled':''}><i class="fas fa-chevron-up"></i></button><button class="move-btn" onclick="moveCategoryDown(${category.id})" ${index===categories.length-1?'disabled':''}><i class="fas fa-chevron-down"></i></button></div></td><td><div class="admin-actions"><button class="btn btn-primary btn-sm" onclick="editCategory(${category.id})" title="Редактировать"><i class="fas fa-edit fa-lg"></i></button><button class="btn btn-danger btn-sm" onclick="showDeleteConfirmation('category',${category.id})" title="Удалить"><i class="fas fa-trash fa-lg"></i></button></div></td>`;categoriesList.appendChild(row)})}
        
        function showDeleteConfirmation(type,id){let message='';let entityName='';switch(type){case'product':message='Вы уверены, что хотите удалить этот товар?';entityName='товар';break;case'category':message='Вы уверены, что хотите удалить эту категорию? Товары в этой категории станут без категории.';entityName='категорию';break;case'order':message='Вы уверены, что хотите удалить этот заказ?';entityName='заказ';break;case'promocode':message='Вы уверены, что хотите удалить этот промокод?';entityName='промокод';break;case'admin':message='Вы уверены, что хотите удалить этого администратора?';entityName='администратора';break}showConfirmationModal(message,type,id,deleteEntity)}

        function deleteEntity(id,type){switch(type){case'product':deleteProduct(id);break;case'category':deleteCategory(id);break;case'order':deleteOrder(id);break;case'promocode':deletePromocode(id);break;case'admin':deleteAdmin(id);break}}

        async function moveCategoryUp(categoryId){const categories=adminData.categories;const index=categories.findIndex(c=>c.id===categoryId);if(index>0){[categories[index],categories[index-1]]=[categories[index-1],categories[index]];await updateCategoriesOrder();renderCategoriesAdmin(categories)}}
        
        async function moveCategoryDown(categoryId){const categories=adminData.categories;const index=categories.findIndex(c=>c.id===categoryId);if(index<categories.length-1){[categories[index],categories[index+1]]=[categories[index+1],categories[index]];await updateCategoriesOrder();renderCategoriesAdmin(categories)}} 
        
        async function moveCategoryUp(categoryId){const categories=adminData.categories;const index=categories.findIndex(c=>c.id===categoryId);if(index>0){[categories[index],categories[index-1]]=[categories[index-1],categories[index]];await updateCategoriesOrder();loadCategories()}}

        async function moveCategoryDown(categoryId){const categories=adminData.categories;const index=categories.findIndex(c=>c.id===categoryId);if(index<categories.length-1){[categories[index],categories[index+1]]=[categories[index+1],categories[index]];await updateCategoriesOrder();loadCategories()}}

        async function updateProductsOrder(){const productsOrder={};adminData.products.forEach((product,index)=>{productsOrder[product.id]=index+1});try{const response=await fetch('/api/products',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({reorder:productsOrder})});const result=await response.json();if(result.success){showToast('Порядок товаров обновлен','success')}}catch(error){console.error('Error updating products order:',error);showToast('Ошибка обновления порядка','error')}}

        async function updateCategoriesOrder(){const categoriesOrder={};adminData.categories.forEach((category,index)=>{categoriesOrder[category.id]=index+1});try{const response=await fetch('/api/admin/categories/reorder',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({reorder:categoriesOrder})});const result=await response.json();if(result.success){showToast('Порядок категорий обновлен','success')}}catch(error){console.error('Error updating categories order:',error);showToast('Ошибка обновления порядка','error')}}

        async function loadOrdersAdmin(){try{const response=await fetch('/api/order',{headers:{'Is-Admin':'true','User-Id':tg.initDataUnsafe.user?.id||''}});const orders=await response.json();adminData.orders=orders;renderOrdersAdmin(orders)}catch(error){console.error('Error loading orders admin:',error)}}

        function renderOrdersAdmin(orders){const ordersList=document.getElementById('ordersList');const pagination=document.getElementById('ordersPagination');ordersList.innerHTML='';if(orders.length===0){ordersList.innerHTML='<tr><td colspan="5" class="empty-table-message">Заказы не найдены</td></tr>';pagination.innerHTML='';return}const statusNames={1:{name:'Новый',color:'#EF4444',class:'new'},2:{name:'Подтвержден',color:'#F59E0B',class:'confirmed'},3:{name:'Собирается',color:'#8B5CF6',class:'confirmed'},4:{name:'В пути',color:'#3B82F6',class:'confirmed'},5:{name:'Доставлен',color:'#10B981',class:'delivered'},6:{name:'Отменен',color:'#6B7280',class:'cancelled'}};const startIndex=(currentOrdersPage-1)*ordersPerPage;const endIndex=startIndex+ordersPerPage;const paginatedOrders=orders.slice(startIndex,endIndex);paginatedOrders.forEach(order=>{const status=statusNames[order.status_id]||{name:'Неизвестен',color:'#6B7280',class:'new'};const telegramLink=`tg://openmessage?user_id=${order.user_id}`;const phoneLink=`https://t.me/+${order.phone.replace(/\D/g,'')}`;const row=document.createElement('tr');row.className='table-row';row.innerHTML=`<td>#${order.id}</td><td><strong>${order.user_name}</strong><div style="font-size:11px;color:var(--text-light)">${order.phone}</div></td><td><strong>${order.final_amount||order.total_amount} ₽</strong></td><td><span class="badge ${status.class}">${status.name}</span></td><td><div class="admin-actions"><button class="contact-btn" onclick="window.open('${telegramLink}')" title="Написать по ID"><i class="fas fa-user fa-sm"></i></button><button class="contact-btn" onclick="window.open('${phoneLink}')" title="Написать по номеру"><i class="fas fa-phone fa-sm"></i></button><button class="btn btn-primary btn-sm" onclick="changeOrderStatus(${order.id})" title="Изменить статус"><i class="fas fa-edit fa-lg"></i></button><button class="btn btn-danger btn-sm" onclick="showDeleteConfirmation('order',${order.id})" title="Удалить заказ"><i class="fas fa-trash fa-lg"></i></button></div></td>`;ordersList.appendChild(row)});const totalPages=Math.ceil(orders.length/ordersPerPage);pagination.innerHTML='';for(let i=1;i<=totalPages;i++){const pageBtn=document.createElement('button');pageBtn.className=`page-btn ${i===currentOrdersPage?'active':''}`;pageBtn.textContent=i;pageBtn.onclick=()=>{currentOrdersPage=i;renderOrdersAdmin(adminData.orders)};pagination.appendChild(pageBtn)}}

        async function loadPromocodes(){try{const response=await fetch('/api/promocodes',{headers:{'Telegram-Id':tg.initDataUnsafe.user?.id||''}});const promocodes=await response.json();adminData.promocodes=promocodes;renderPromocodes(promocodes)}catch(error){console.error('Error loading promocodes:',error)}}

        function renderPromocodes(promocodes){const promocodesList=document.getElementById('promocodesList');promocodesList.innerHTML='';if(promocodes.length===0){promocodesList.innerHTML='<tr><td colspan="5" class="empty-table-message">Промокоды не найдены</td></tr>';return}promocodes.forEach(promo=>{const row=document.createElement('tr');row.className='table-row';row.innerHTML=`<td><strong>${promo.code}</strong></td><td><div class="promo-discount">${promo.discount_value}${promo.discount_type==='percentage'?'%':'₽'}</div></td><td>${promo.used_count||0}/${promo.max_uses||'∞'}</td><td><span class="badge ${promo.is_active?'delivered':'cancelled'}">${promo.is_active?'Активен':'Неактивен'}</span></td><td>${currentUserRole==='owner'?`<button class="btn btn-danger btn-sm" onclick="showDeleteConfirmation('promocode',${promo.id})"><i class="fas fa-trash"></i></button>`:'-'}</td>`;promocodesList.appendChild(row)})}

        async function loadAdmins(){try{const response=await fetch('/api/admin/admins');const admins=await response.json();adminData.admins=admins;renderAdmins(admins)}catch(error){console.error('Error loading admins:',error)}}

        function renderAdmins(admins){const adminsList=document.getElementById('adminsList');adminsList.innerHTML='';if(admins.length===0){adminsList.innerHTML='<tr><td colspan="5" class="empty-table-message">Администраторы не найдены</td></tr>';return}admins.forEach(admin=>{const row=document.createElement('tr');row.className='table-row';row.innerHTML=`<td>${admin.id}</td><td>${admin.first_name}</td><td>@${admin.username}</td><td><span class="role-badge ${admin.role==='owner'?'role-owner':'role-admin'}">${admin.role==='owner'?'Владелец':'Админ'}</span></td><td>${admin.role!=='owner'&&currentUserRole==='owner'?`<button class="btn btn-danger btn-sm" onclick="showDeleteConfirmation('admin',${admin.id})"><i class="fas fa-trash"></i></button>`:'<span style="color:var(--text-light);font-size:10px">Нельзя удалить</span>'}</td>`;adminsList.appendChild(row)})}

        async function loadSettings(){try{const response=await fetch('/api/admin/settings');const settings=await response.json();adminData.settings=settings;document.getElementById('shopNameInput').value=settings.shop_name?.value||'🌸 Flower Shop';document.getElementById('shopSubtitleInput').value=settings.shop_subtitle?.value||'Элитные букеты с доставкой по Ярославлю';document.getElementById('shopPhone').value=settings.contacts?.phone||'+7 (999) 123-45-67';document.getElementById('shopAddress').value=settings.contacts?.address||'Ярославль, ул. Цветочная, 15';document.getElementById('shopWorkingHours').value=settings.working_hours?.value||'Ежедневно с 9:00 до 21:00';document.getElementById('deliveryPrice').value=settings.delivery_price?.value||200;document.getElementById('freeDeliveryMin').value=settings.free_delivery_min?.value||3000;deliveryPrice=settings.delivery_price?.value||200;freeDeliveryMin=settings.free_delivery_min?.value||3000;updateShopHeader();const themesResponse=await fetch('/api/admin/themes');const themes=await themesResponse.json();adminData.themes=themes;const activeThemeId=settings.active_theme?.value||'4';renderThemes(themes,activeThemeId);applyTheme(activeThemeId);if(settings.header_patterns){activePattern=settings.header_patterns.active||'dots';applyPattern(activePattern);document.querySelectorAll('.pattern-option').forEach(opt=>opt.classList.remove('selected'));const selectedPattern=document.querySelector(`.pattern-option[data-pattern="${activePattern}"]`);if(selectedPattern){selectedPattern.classList.add('selected');}}document.getElementById('snowEffect').checked=settings.snow_effect?.value||false;snowEnabled=settings.snow_effect?.value||false;toggleSnowfall(snowEnabled);document.getElementById('rainEffect').checked=settings.rain_effect?.value||false;rainEnabled=settings.rain_effect?.value||false;toggleRainfall(rainEnabled);document.getElementById('confettiEffect').checked=settings.confetti_effect?.value||false;confettiEnabled=settings.confetti_effect?.value||false;toggleConfetti(confettiEnabled);document.getElementById('nightEffect').checked=settings.night_effect?.value||false;nightEnabled=settings.night_effect?.value||false;toggleNightMode(nightEnabled);}catch(error){console.error('Error loading settings:',error)}}
        
        function renderThemes(themes,activeThemeId){const themeGrid=document.getElementById('themeGrid');themeGrid.innerHTML='';themes.sort((a,b)=>a.id-b.id).forEach(theme=>{const themeOption=document.createElement('div');themeOption.className=`theme-option ${theme.id==activeThemeId?'selected':''}`;themeOption.style.background=theme.background_value;themeOption.setAttribute('data-theme-id',theme.id);themeOption.onclick=()=>selectTheme(theme.id);themeGrid.appendChild(themeOption)})}
        
        function selectTheme(themeId){fetch('/api/themes',{method:'PUT',headers:{'Content-Type':'application/json','Telegram-Id':String(tg.initDataUnsafe.user?.id||'')},body:JSON.stringify({theme_id:themeId})}).then(response=>response.json()).then(result=>{if(result.success){document.querySelectorAll('.theme-option').forEach(opt=>opt.classList.remove('selected'));const selectedTheme=document.querySelector(`.theme-option[data-theme-id="${themeId}"]`);if(selectedTheme){selectedTheme.classList.add('selected');}applyTheme(themeId);showToast('Тема применена','success')}}).catch(error=>{console.error('Error selecting theme:',error);showToast('Ошибка применения темы','error')})}

        function applyTheme(themeId){const theme=adminData.themes.find(t=>t.id==themeId);if(theme){const root=document.documentElement;const bgColor=theme.background_value;root.style.setProperty('--header-bg',bgColor);root.style.setProperty('--primary','#6b7280');root.style.setProperty('--primary-dark','#374151');root.style.setProperty('--primary-light','#d1d5db');root.style.setProperty('--secondary','#9ca3af');root.style.setProperty('--accent','#6b7280');root.style.setProperty('--accent-dark','#374151');root.style.setProperty('--price-color','#000000');root.style.setProperty('--button-bg','linear-gradient(135deg,#6b7280 0%,#374151 100%)');root.style.setProperty('--fact-border','#6b7280');root.style.setProperty('--fact-icon','#f59e0b');document.body.style.background=bgColor;document.getElementById('shopHeader').style.background=bgColor;document.querySelector('.admin-header').style.background=bgColor;document.querySelector('.help-header').style.background=bgColor;fetch('/api/admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({key:'active_theme',value:{value:themeId}})});}}

        function selectPattern(pattern){activePattern=pattern;document.querySelectorAll('.pattern-option').forEach(opt=>opt.classList.remove('selected'));document.querySelector(`.pattern-option[data-pattern="${pattern}"]`).classList.add('selected');applyPattern(pattern);fetch('/api/themes',{method:'PUT',headers:{'Content-Type':'application/json','Telegram-Id':String(tg.initDataUnsafe.user?.id||'')},body:JSON.stringify({pattern:pattern})}).then(response=>response.json()).then(result=>{if(result.success){showToast('Узор применен','success')}}).catch(error=>{console.error('Error selecting pattern:',error);showToast('Ошибка применения узора','error')})}

        function applyPattern(pattern){const header=document.getElementById('shopHeader');if(header){header.className='header '+pattern;}}

        function bindPatternOptions(){
            document.querySelectorAll('.pattern-option').forEach(opt=>{
                if(opt.dataset.bound==='1') return;
                opt.dataset.bound='1';
                opt.addEventListener('click',()=>selectPattern(opt.dataset.pattern));
            });
        }

        function updateShopHeader(){document.getElementById('shopName').textContent=document.getElementById('shopNameInput').value;document.getElementById('shopSubtitle').textContent=document.getElementById('shopSubtitleInput').value;document.getElementById('deliveryInfoText').textContent=`Доставка ${deliveryPrice}₽ • Бесплатно от ${freeDeliveryMin}₽`;document.getElementById('workingHoursText').textContent=document.getElementById('shopWorkingHours').value;document.getElementById('deliveryPriceText').textContent=`${deliveryPrice} ₽`}

        function toggleProductForm(){const content=document.getElementById('productFormContent');const icon=document.getElementById('productFormIcon');content.classList.toggle('expanded');icon.style.transform=content.classList.contains('expanded')?'rotate(180deg)':'rotate(0deg)'}

        function toggleCategoryForm(){const content=document.getElementById('categoryFormContent');const icon=document.getElementById('categoryFormIcon');content.classList.toggle('expanded');icon.style.transform=content.classList.contains('expanded')?'rotate(180deg)':'rotate(0deg)'}

        function togglePromoForm(){const content=document.getElementById('promoFormContent');const icon=document.getElementById('promoFormIcon');content.classList.toggle('expanded');icon.style.transform=content.classList.contains('expanded')?'rotate(180deg)':'rotate(0deg)'}

        function toggleAdminForm(){const content=document.getElementById('adminFormContent');const icon=document.getElementById('adminFormIcon');content.classList.toggle('expanded');icon.style.transform=content.classList.contains('expanded')?'rotate(180deg)':'rotate(0deg)'}

        function toggleSection(sectionId){const section=document.getElementById(sectionId);section.classList.toggle('expanded')}

        async function addProduct(){var e=document.getElementById('categoryDropdownToggle');var t=e.dataset.selectedValue||'';var n={name:document.getElementById('productName').value,price:parseInt(document.getElementById('productPrice').value),image_url:document.getElementById('productImage').value,category:t,description:document.getElementById('productDescription').value,fact:document.getElementById('productFact').value,is_available:true,is_featured:document.getElementById('productFeatured').checked};if(!n.name||!n.price){showToast('Заполните название и цену','error');return}try{var i=await fetch('/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(n)});var r=await i.json();if(r.success){showToast('Товар успешно добавлен','success');loadProductsAdmin();resetProductForm();loadProducts()}}catch(e){console.error('Error adding product:',e);showToast('Ошибка добавления товара','error')}}
        
        async function addCategory(){if(!selectedIcon){showToast('Выберите иконку для категории','error');return}const category={name:document.getElementById('categoryName').value,slug:document.getElementById('categorySlug').value,icon:selectedIcon};if(!category.name||!category.slug){showToast('Заполните название и slug категории','error');return}try{const response=await fetch('/api/admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(category)});const result=await response.json();if(result.success){showToast('Категория успешно создана','success');loadCategories();resetCategoryForm();renderCategoriesAdmin(adminData.categories)}}catch(error){console.error('Error adding category:',error);showToast('Ошибка создания категории','error')}}

        async function editCategory(categoryId){const category=adminData.categories.find(c=>c.id===categoryId);if(!category)return;document.getElementById('editCategoryId').value=category.id;document.getElementById('editCategoryName').value=category.name;document.getElementById('editCategorySlug').value=category.slug;document.getElementById('editCategoryActive').checked=category.is_active;selectedIcon=category.icon;renderEditIconGrid();document.getElementById('editCategoryModal').style.display='flex'}

        function renderEditIconGrid(){const editIconGrid=document.getElementById('editIconGrid');editIconGrid.innerHTML='';const icons=['fas fa-heart','fas fa-star','fas fa-sun','fas fa-moon','fas fa-leaf','fas fa-spa','fas fa-seedling','fas fa-feather','fas fa-cloud','fas fa-fire','fas fa-tint','fas fa-snowflake','fas fa-tree','fas fa-mountain','fas fa-umbrella','fas fa-gem'];icons.forEach(icon=>{const option=document.createElement('div');option.className=`icon-option ${icon===selectedIcon?'selected':''}`;option.dataset.icon=icon;option.innerHTML=`<i class="${icon}"></i><div>${icon.split('fa-')[1]}</div>`;option.addEventListener('click',function(){document.querySelectorAll('.icon-option').forEach(opt=>opt.classList.remove('selected'));this.classList.add('selected');selectedIcon=this.dataset.icon;});editIconGrid.appendChild(option);});}

        async function updateCategory(){const categoryId=document.getElementById('editCategoryId').value;const category={name:document.getElementById('editCategoryName').value,slug:document.getElementById('editCategorySlug').value,icon:selectedIcon,is_active:document.getElementById('editCategoryActive').checked};try{const response=await fetch('/api/admin/category/'+categoryId,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(category)});const result=await response.json();if(result.success){showToast('Категория успешно обновлена','success');document.getElementById('editCategoryModal').style.display='none';loadCategories();renderCategoriesAdmin(adminData.categories)}}catch(error){console.error('Error updating category:',error);showToast('Ошибка обновления категории','error')}}

        async function addPromocode(){const promoData={code:document.getElementById('promoCode').value,discount_type:selectedDiscountType,discount_value:parseInt(document.getElementById('promoDiscountValue').value),min_order_amount:parseInt(document.getElementById('promoMinOrder').value)||0,max_uses:document.getElementById('promoMaxUses').value?parseInt(document.getElementById('promoMaxUses').value):null,valid_until:document.getElementById('promoValidUntil').value||null};if(!promoData.code||!promoData.discount_value){showToast('Заполните код и значение скидки','error');return}try{const response=await fetch('/api/promocodes',{method:'POST',headers:{'Content-Type':'application/json','Telegram-Id':tg.initDataUnsafe.user?.id||''},body:JSON.stringify(promoData)});const result=await response.json();if(result.success){showToast('Промокод успешно создан','success');loadPromocodes();resetPromoForm()}}catch(error){console.error('Error adding promocode:',error);showToast('Ошибка создания промокода','error')}}

        async function editProduct(productId){const product=adminData.products.find(p=>p.id===productId);if(!product)return;document.getElementById('editProductId').value=product.id;document.getElementById('editProductName').value=product.name;document.getElementById('editProductPrice').value=product.price;document.getElementById('editProductImage').value=product.image_url;selectedCategory=product.category;document.getElementById('editCategoryDropdownToggle').querySelector('span').textContent=adminData.categories.find(c=>c.slug===product.category)?.name||product.category;document.getElementById('editProductDescription').value=product.description||'';document.getElementById('editProductFact').value=product.fact||'';document.getElementById('editProductAvailable').checked=product.is_available;document.getElementById('editProductFeatured').checked=product.is_featured||false;document.getElementById('editProductModal').style.display='flex'}

        async function updateProduct(){var e=document.getElementById('editProductId').value;var t={name:document.getElementById('editProductName').value,price:parseInt(document.getElementById('editProductPrice').value),image_url:document.getElementById('editProductImage').value,category:selectedCategory||'',description:document.getElementById('editProductDescription').value,fact:document.getElementById('editProductFact').value,is_available:document.getElementById('editProductAvailable').checked,is_featured:document.getElementById('editProductFeatured').checked};try{var n=await fetch('/api/products',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({...t,id:parseInt(e)})});var i=await n.json();if(i.success){showToast('Товар успешно обновлен','success');document.getElementById('editProductModal').style.display='none';await loadProductsAdmin();loadProducts()}}catch(e){console.error('Error updating product:',e);showToast('Ошибка обновления товара','error')}}
        
        async function deleteProduct(productId){try{const response=await fetch(`/api/products/${productId}`,{method:'DELETE'});const result=await response.json();if(result.success){showToast('Товар удален','success');loadProductsAdmin();loadProducts()}}catch(error){console.error('Error deleting product:',error);showToast('Ошибка удаления товара','error')}}

        async function deleteCategory(categoryId){try{const response=await fetch(`/api/admin/category/${categoryId}`,{method:'DELETE'});const result=await response.json();if(result.success){showToast('Категория удалена','success');loadCategories();renderCategoriesAdmin(adminData.categories)}}catch(error){console.error('Error deleting category:',error);showToast('Ошибка удаления категории','error')}}

        async function deletePromocode(promocodeId){try{const response=await fetch(`/api/promocodes/${promocodeId}`,{method:'DELETE',headers:{'Telegram-Id':tg.initDataUnsafe.user?.id||''}});const result=await response.json();if(result.success){showToast('Промокод удален','success');loadPromocodes()}}catch(error){console.error('Error deleting promocode:',error);showToast('Ошибка удаления промокода','error')}}

        function changeOrderStatus(orderId){currentOrderId=orderId;selectedStatus=null;document.querySelectorAll('.status-option').forEach(opt=>opt.classList.remove('selected'));document.getElementById('applyStatusBtn').disabled=true;document.getElementById('statusModal').style.display='flex'}

        function selectStatus(status){selectedStatus=status;document.querySelectorAll('.status-option').forEach(opt=>opt.classList.remove('selected'));document.querySelector(`.status-option[data-status="${status}"]`).classList.add('selected');document.getElementById('applyStatusBtn').disabled=false}

        function applyStatusChange(){if(!selectedStatus||!currentOrderId)return;updateOrderStatus(currentOrderId,selectedStatus);closeStatusModal()}

        function closeStatusModal(){document.getElementById('statusModal').style.display='none'}

        async function updateOrderStatus(orderId,statusId){try{const response=await fetch('/api/order',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({order_id:parseInt(orderId),status_id:parseInt(statusId)})});const result=await response.json();if(result.success){showToast('Статус заказа обновлен','success');loadOrdersAdmin()}}catch(error){console.error('Error updating order status:',error);showToast('Ошибка обновления статуса','error')}}

        async function deleteOrder(orderId){try{const response=await fetch(`/api/order/${orderId}`,{method:'DELETE'});const result=await response.json();if(result.success){showToast('Заказ удален','success');loadOrdersAdmin()}}catch(error){console.error('Error deleting order:',error);showToast('Ошибка удаления заказа','error')}}

        async function addAdmin(){const admin={telegram_id:document.getElementById('adminTelegramId').value,username:document.getElementById('adminUsername').value.replace('@',''),first_name:document.getElementById('adminFirstName').value,role:selectedRole};if(!admin.telegram_id||!admin.first_name){showToast('Заполните обязательные поля','error');return}try{const response=await fetch('/api/admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(admin)});const result=await response.json();if(result.success){showToast('Администратор добавлен','success');loadAdmins();resetAdminForm()}}catch(error){console.error('Error adding admin:',error);showToast('Ошибка добавления администратора','error')}}

        async function deleteAdmin(adminId){try{const response=await fetch(`/api/admin/${adminId}`,{method:'DELETE'});const result=await response.json();if(result.success){showToast('Администратор удален','success');loadAdmins()}}catch(error){console.error('Error deleting admin:',error);showToast('Ошибка удаления администратора','error')}}

        function resetProductForm(){document.getElementById('productName').value='';document.getElementById('productPrice').value='';document.getElementById('productImage').value='';document.getElementById('productDescription').value='';document.getElementById('productFact').value='';document.getElementById('productFeatured').checked=false;selectedCategory=null;document.getElementById('categoryDropdownToggle').querySelector('span').textContent='Выберите категорию'}

        function resetCategoryForm(){document.getElementById('categoryName').value='';document.getElementById('categorySlug').value='';selectedIcon=null;document.querySelectorAll('.icon-option').forEach(opt=>opt.classList.remove('selected'))}

        function resetPromoForm(){document.getElementById('promoCode').value='';document.getElementById('promoDiscountValue').value='';document.getElementById('promoMinOrder').value='';document.getElementById('promoMaxUses').value='';document.getElementById('promoValidUntil').value='';selectedDiscountType='percentage';document.getElementById('discountTypeDropdownToggle').querySelector('span').textContent='Тип скидки'}

        function resetAdminForm(){document.getElementById('adminTelegramId').value='';document.getElementById('adminUsername').value='';document.getElementById('adminFirstName').value='';selectedRole='admin';document.getElementById('roleDropdownToggle').querySelector('span').textContent='Выберите роль'}

        function filterProducts(){const searchTerm=document.getElementById('productSearch').value.toLowerCase();const activeFilter=document.querySelector('.filter-btn.active')?.dataset.status||'all';currentProductFilter=activeFilter;currentProductSearch=searchTerm;let filteredProducts=adminData.products;if(activeFilter==='active'){filteredProducts=adminData.products.filter(product=>product.is_available)}else if(activeFilter==='inactive'){filteredProducts=adminData.products.filter(product=>!product.is_available)}if(searchTerm){filteredProducts=filteredProducts.filter(product=>product.name.toLowerCase().includes(searchTerm)||(product.description&&product.description.toLowerCase().includes(searchTerm))||(product.category&&product.category.toLowerCase().includes(searchTerm)))}renderProductsAdmin(filteredProducts)} 
            
        function filterOrders(){const searchTerm=document.getElementById('orderSearch').value.toLowerCase();const activeFilter=document.querySelector('.filter-btn.active')?.dataset.status||'all';const filteredOrders=adminData.orders.filter(order=>{const matchesSearch=order.user_name.toLowerCase().includes(searchTerm)||order.phone.includes(searchTerm)||order.id.toString().includes(searchTerm);const matchesFilter=activeFilter==='all'||order.status_id.toString()===activeFilter;return matchesSearch&&matchesFilter});renderOrdersAdmin(filteredOrders)}

        async function saveShopSettings(){try{const settings={shop_name:document.getElementById('shopNameInput').value,shop_subtitle:document.getElementById('shopSubtitleInput').value,phone:document.getElementById('shopPhone').value,address:document.getElementById('shopAddress').value,working_hours:document.getElementById('shopWorkingHours').value,delivery_price:parseInt(document.getElementById('deliveryPrice').value),free_delivery_min:parseInt(document.getElementById('freeDeliveryMin').value),snow_effect:document.getElementById('snowEffect').checked,rain_effect:document.getElementById('rainEffect').checked,confetti_effect:document.getElementById('confettiEffect').checked,night_effect:document.getElementById('nightEffect').checked};deliveryPrice=settings.delivery_price;freeDeliveryMin=settings.free_delivery_min;snowEnabled=settings.snow_effect;rainEnabled=settings.rain_effect;confettiEnabled=settings.confetti_effect;nightEnabled=settings.night_effect;const updateData=[{key:'shop_name',value:{value:settings.shop_name}},{key:'shop_subtitle',value:{value:settings.shop_subtitle}},{key:'contacts',value:{phone:settings.phone,address:settings.address}},{key:'working_hours',value:{value:settings.working_hours}},{key:'delivery_price',value:{value:settings.delivery_price}},{key:'free_delivery_min',value:{value:settings.free_delivery_min}},{key:'header_patterns',value:{patterns:['dots','lines','flowers','hearts','stars','waves','geometric'],active:activePattern}},{key:'snow_effect',value:{value:settings.snow_effect}},{key:'rain_effect',value:{value:settings.rain_effect}},{key:'confetti_effect',value:{value:settings.confetti_effect}},{key:'night_effect',value:{value:settings.night_effect}}];let successCount=0;for(const setting of updateData){const response=await fetch('/api/admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(setting)});if(response.ok){successCount++}}if(successCount>0){showToast('Настройки успешно сохранены','success');updateShopHeader();toggleSnowfall(snowEnabled);toggleRainfall(rainEnabled);toggleConfetti(confettiEnabled);toggleNightMode(nightEnabled);}else{showToast('Ошибка сохранения настроек','error')}}catch(error){console.error('Error saving settings:',error);showToast('Ошибка сохранения настроек','error')}}

        function createSnowfall(){const container=document.getElementById('snowContainer');container.innerHTML='';snowflakes=[];for(let i=0;i<50;i++){const snowflake=document.createElement('div');snowflake.className='snowflake';const size=Math.random()*5+2;snowflake.style.width=size+'px';snowflake.style.height=size+'px';snowflake.style.left=Math.random()*100+'%';snowflake.style.opacity=Math.random()*0.6+0.4;snowflake.style.animationDuration=(Math.random()*5+5)+'s';snowflake.style.animationDelay=Math.random()*5+'s';container.appendChild(snowflake);snowflakes.push(snowflake)}}

        function toggleSnowfall(enabled){const container=document.getElementById('snowContainer');if(enabled){container.style.display='block';createSnowfall();}else{container.style.display='none';snowflakes.forEach(flake=>flake.remove());snowflakes=[];}}

        function createRainfall(){const container=document.getElementById('rainContainer');container.innerHTML='';raindrops=[];for(let i=0;i<100;i++){const raindrop=document.createElement('div');raindrop.className='raindrop';const left=Math.random()*100;const animationDuration=Math.random()*0.8+0.4;const height=Math.random()*10+15;raindrop.style.left=left+'%';raindrop.style.height=height+'px';raindrop.style.animationDuration=animationDuration+'s';raindrop.style.animationDelay=Math.random()*2+'s';container.appendChild(raindrop);raindrops.push(raindrop)}}

        function toggleRainfall(enabled){const container=document.getElementById('rainContainer');if(enabled){container.style.display='block';createRainfall();}else{container.style.display='none';raindrops.forEach(drop=>drop.remove());raindrops=[];}}

        function createConfetti(){const container=document.getElementById('confettiContainer');container.innerHTML='';confettiPieces=[];const colors=['#6b7280','#9ca3af','#f59e0b','#84cc16','#10b981','#3b82f6','#8b5cf6','#ec4899','#f97316','#eab308','#06b6d4','#a855f7'];for(let i=0;i<120;i++){const confetti=document.createElement('div');confetti.className='confetti';const size=Math.random()*10+6;const color=colors[Math.floor(Math.random()*colors.length)];confetti.style.width=size+'px';confetti.style.height=size+'px';confetti.style.background=color;confetti.style.left=Math.random()*100+'%';confetti.style.borderRadius=Math.random()>0.5?'50%':'0';confetti.style.animationDuration=(Math.random()*3+2)+'s';confetti.style.animationDelay=Math.random()*2+'s';confetti.style.transform=`rotate(${Math.random()*360}deg)`;container.appendChild(confetti);confettiPieces.push(confetti)}}

        function toggleConfetti(enabled){const container=document.getElementById('confettiContainer');if(enabled){container.style.display='block';createConfetti();}else{container.style.display='none';confettiPieces.forEach(piece=>piece.remove());confettiPieces=[];}}

        function createNightMode(){
            const container=document.getElementById('nightContainer');
            container.innerHTML='';
            const overlay=document.createElement('div');
            overlay.className='night-overlay';
            container.appendChild(overlay);
            const spot=document.createElement('div');
            spot.className='light-spot dynamic-spot';
            spot.style.opacity='0';
            container.appendChild(spot);
            lightSpots=[spot];
            document.body.classList.add('night-mode-active');
        }

        function moveDynamicSpot(x,y,opacity){
            const spot=document.querySelector('.dynamic-spot');
            if(!spot) return;
            spot.style.left=x+'px';
            spot.style.top=y+'px';
            spot.style.opacity=opacity;
        }

        function clearDynamicSpot(){
            const spot=document.querySelector('.dynamic-spot');
            if(spot){spot.style.opacity='0';}
        }

        function setupNightTouchEffect(container){
            const handleMove=(e)=>{
                if(!nightEnabled) return;
                const point=e.touches?e.touches[0]:e;
                moveDynamicSpot(point.clientX,point.clientY,e.touches?0.9:0.6);
            };
            const handleEnd=()=>{clearDynamicSpot();};
            document.addEventListener('touchstart',handleMove,{passive:true});
            document.addEventListener('touchmove',handleMove,{passive:true});
            document.addEventListener('touchend',handleEnd,{passive:true});
            document.addEventListener('mousemove',handleMove);
            document.addEventListener('mouseleave',handleEnd);
        }

        function toggleNightMode(enabled){
            const container=document.getElementById('nightContainer');
            nightEnabled=enabled;
            if(enabled){
                container.style.display='block';
                createNightMode();
                setupNightEffect();
                setupNightTouchEffect(container);
            }else{
                container.style.display='none';
                document.body.classList.remove('night-mode-active');
                lightSpots.forEach(spot=>spot.remove());
                lightSpots=[];
                clearDynamicSpot();
            }
        }

        function showDangerousConfirmation(action,code){const actionTitles={'reset_orders':'Удаление всех заказов','reset_stats':'Сброс статистики','delete_promocodes':'Удаление всех промокодов','delete_products':'Удаление всех товаров','clear_customers':'Очистка базы клиентов','reset_shop':'Полный сброс магазина'};const actionMessages={'reset_orders':'Это действие полностью удалит все заказы из системы. Восстановление данных будет невозможно.','reset_stats':'Обнулит всю статистику выручки и прибыли. Заказы останутся, но их финансовые показатели будут сброшены.','delete_promocodes':'Полностью удалит все промокоды из системы. Действие необратимо.','delete_products':'Полностью удалит все товары из каталоге. Действие необратимо.','clear_customers':'Удалит всех клиентов из системы. Статистика заказов сохранится.','reset_shop':'Полностью очистит всю базу данных магазина. Все данные будут удалены без возможности восстановления.'};document.getElementById('dangerousModalTitle').textContent=actionTitles[action]||'Подтверждение действия';document.getElementById('dangerousModalMessage').textContent=actionMessages[action]||'Вы уверены, что хотите выполнить это действие? Это действие нельзя отменить!';document.getElementById('dangerousActionModal').style.display='flex';}
        
        function closeDangerousModal(){document.getElementById('dangerousActionModal').style.display='none';currentDangerousAction=null;currentDangerousCode=null;}
        
        function executeDangerousAction(){closeDangerousModal();const t=document.getElementById("confirmDangerousAction");if(!t)return void showToast("Ошибка: Кнопка не найдена","error");const e=t.dataset.action||currentDangerousAction,n=t.dataset.code||currentConfirmationCode;if(!e||!n)return void showToast("Ошибка данных","error");t.disabled=!0;const o=t.textContent;t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Загрузка...',fetch("/api/dangerous",{method:"POST",headers:{"Content-Type":"application/json","Telegram-Id":tg.initDataUnsafe.user?.id||""},body:JSON.stringify({action:e,confirmation_code:n})}).then(t=>t.json()).then(e=>{t.disabled=!1,t.textContent=o,e.success?(showToast(e.message||"Успешно выполнено!","success"),currentDangerousAction=null,currentConfirmationCode=null,t.removeAttribute("data-action"),t.removeAttribute("data-code"),"reset_orders"===currentDangerousAction||"reset_shop"===currentDangerousAction?loadOrdersAdmin():"delete_products"===currentDangerousAction&&loadProductsAdmin()):showToast(e.error||"Ошибка сервера","error")}).catch(e=>{console.error(e),t.disabled=!1,t.textContent=o,showToast("Ошибка соединения","error")})}
        
        function setupHelpTabs(){document.querySelectorAll(".help-tab").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".help-tab").forEach(e=>e.classList.remove("active")),this.classList.add("active");const t=this.dataset.help+"Help";document.querySelectorAll(".help-section").forEach(e=>{e.classList.remove("active"),e.id===t&&e.classList.add("active")})})})}
        
        function checkConfirmationCode(action,codeValue){fetch('/api/admin/confirmation-codes').then(response=>response.json()).then(codes=>{const validCode=codes.find(c=>c.code===codeValue&&c.is_active);if(validCode){currentDangerousAction=action;currentConfirmationCode=codeValue;document.getElementById('confirmDangerousAction').dataset.action=action;document.getElementById('confirmDangerousAction').dataset.code=codeValue;showDangerousConfirmation(action,codeValue);}else{showToast('Неверный код подтверждения','error');}}).catch(error=>{console.error('Error checking confirmation code:',error);showToast('Ошибка проверки кода','error');});}
        
        function dangerousAction(action){let codeInput;if(action==='reset_orders'){codeInput=document.getElementById('reset_ordersCode');}else if(action==='reset_stats'){codeInput=document.getElementById('reset_statsCode');}else if(action==='delete_promocodes'){codeInput=document.getElementById('delete_promocodesCode');}else if(action==='delete_products'){codeInput=document.getElementById('delete_productsCode');}else if(action==='clear_customers'){codeInput=document.getElementById('clear_customersCode');}else if(action==='reset_shop'){codeInput=document.getElementById('reset_shopCode');}if(!codeInput){showToast('Ошибка: не найдено поле ввода','error');return;}const codeValue=codeInput.value;if(!codeValue){showToast('Введите код подтверждения','error');return;}checkConfirmationCode(action,codeValue);}

        function setupOrderValidation(){const e=document.getElementById('phoneInput'),t=document.getElementById('deliveryAddress'),n=document.getElementById('confirmOrderBtn');function checkOrderForm(){const i=e.value.trim(),o=t.value.trim(),s=deliveryOption==='delivery'?o.length>0:!0;n.disabled=!(validatePhone(i)&&s&&cart.length>0);}e.addEventListener('input',checkOrderForm);t.addEventListener('input',checkOrderForm);document.querySelectorAll('.delivery-option').forEach(e=>{e.addEventListener('click',()=>{setTimeout(checkOrderForm,100);})});checkOrderForm();}
        
        function showLoadingScreen(){const e=document.getElementById('loadingScreen');e&&(e.style.display='flex',e.style.opacity='1',e.style.visibility='visible');}
        
        function hideLoadingScreen(){const e=document.getElementById('loadingScreen');e&&(e.style.opacity='0',e.style.visibility='hidden',setTimeout(()=>{e.style.display='none'},800));}
        
        document.addEventListener('DOMContentLoaded',function(){document.querySelectorAll('.filter-btn').forEach(btn=>{btn.addEventListener('click',function(){document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));this.classList.add('active');if(this.closest('#productsTab')){filterProducts()}else{filterOrders()}})})});

        async function initApp(){showLoadingScreen();const e=document.querySelector('.loading-logo');e&&(e.onerror=function(){console.error('Logo failed to load, using fallback');this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiM2QjcyODAiLz4KPHBhdGggZD0iTTc1IDQwQzk1IDYwIDk1IDkwIDc1IDExMEM1NSA5MCA1NSA2MCA3NSA0MFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=';this.onerror=null;},e.onload=function(){console.log('Logo loaded successfully from GitHub');});setTimeout(()=>{hideLoadingScreen();},3000);loadProducts();loadCategories();setupEventListeners();setupHelpTabs();checkAdminAccess();updateCartDisplay();deliveryOption='pickup';const t=document.getElementById('phoneInput'),n=document.getElementById('deliveryAddress');t&&t.addEventListener('input',validateOrderForm);n&&n.addEventListener('input',validateOrderForm);loadSettings();createSnowfall();createRainfall();createConfetti();createNightMode();bindPatternOptions();initDropdowns();initIconSelection();setupConfirmationModal();setupOrderValidation();setupAdminTabs();document.getElementById("adminPanel").style.display="none";document.getElementById("helpView").style.display="none";document.getElementById("customerView").style.display="block";document.getElementById("adminButton").style.display=isAdmin?"flex":"none";document.getElementById("helpButton").style.display="flex";}
        
        window.addEventListener('load',function(){const e=document.querySelector('.loading-logo');e&&(e.onerror=function(){this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiByeD0iNzUiIGZpbGw9IiM2QjcyODAiLz4KPHBhdGggZD0iTTc1IDQwQzk1IDYwIDk1IDkwIDc1IDExMEM1NSA5MCA1NSA2MCA3NSA0MFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=';});});
        
        if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initApp)}else{initApp()}
    </script>

    <div id="ai-modal">
        <div id="ai-close" onclick="toggleAI(false)">×</div>
        <div id="ai-chat-container"></div>
        <div id="ai-input-area">
            <div id="ai-input-wrapper">
                <input type="text" id="ai-user-input" placeholder="Задайте вопрос..." onkeypress="if(event.key==='Enter')sendAIMessage()">
                <button onclick="sendAIMessage()">↑</button>
            </div>
        </div>
    </div>
</body>
</html>
